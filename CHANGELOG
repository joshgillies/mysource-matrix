MYSOURCE MATRIX CHANGELOG

VERSION 3.28.4

Featured Changes
===================================


Allow Assets to be Linked Under Link Assets [ Feature Request #4605 ]
-----------------------------------------------------

A small enhancement has been added to MySource Matrix's Link asset to allow other assets to be linked underneath it, as children of the asset.

For example, you could create a set of Link assets that each have an associated Image as a child. This could then be useful when listing these Links on an Asset Listing, dynamically displaying the associated images alongside the links.

This feature improves the usability of the Link asset, enhancing its performance so that it is more consistent with the other assets within MySource Matrix.


setContentOfEditableFileAsset Function for Javascript API [ Feature Request #4623 ]
-----------------------------------------------------

The release of MySource Matrix v3.28.3 introduced the createFileAsset function for the Javascript API. This function allowed users to create blank File type assets that users could then manually upload their files to. This feature introduces a new function that extends the Javascript API's functionality of File type assets by allowing you to set the content of editable File assets (CSS, XML, Text, XSL and JS Files).

The setContentOfEditableFileAssets function is enabled through a new Set File Content field on the Details screen of the Javascript API.

This function takes three parameters:

    * assetID: ID of the asset to update content for.
    * content: New content of the asset.
    * dataCallback: the custom callback function (optional).

The format of the setContentOfEditableFileAssets function is shown below:

	function setContentOfEditableFileAssets (assetID, content, dataCallback);

Please note that locks need to be acquired on the asset before setting its content.

This function has been added to provide more flexibility for MySource Matrix's integration with the Easy Edit Suite.


Enhancements to the import_from_xml.php Script [ Feature Request #4639 ]
-----------------------------------------------------

Enhancements have been made to the import_from_xml.php script to allow users to set a root node, under which to import their assets.

This script now takes the following two optional arguments:

    * --root-node: the setting of a root node.
    * [ASSET_ID]: the asset ID of the root node to import assets under.

The new structure of the import_from_xml.php script is as follows:

	$ php import_from_xml.php <system_root> <Import File> --root-node [ASSET_ID]

	$ php import_from_xml.php <system_root> import.xml --root-node 125

This function has been added to provide more flexibility for MySource Matrix's integration with the Easy Edit Suite.


Keyword Replacement for Asset URL in Workflow Custom Messages [ Feature Request #4648 ]
-----------------------------------------------------

A new keyword replacement is now available on Workflow Custom Messages to print the URL of the asset that is in Workflow.

    * %asset_url%: The URL of this asset. 

This keyword replacement can be used on all Workflow messages. An example of its usage is shown below:

	Dear %user_name%,

	Your approval is required on asset "<a href=%asset_url%>%asset_name%</a>".

	<a href=%preview_url%>Preview this Asset</a>
	<a href=%accept_url%>Accept these changes</a>
	<a href=%reject_url%>Reject these changes</a>

When the custom message is sent, a link will appear to the asset.

If an asset has multiple URLs, this keyword replacement will return the closest to the current URL.


New Keyword Modifier to Dynamically Supply Asset IDs on Keywords [ Feature Request #4652 ]
-----------------------------------------------------

A new keyword modifier has been added that allows you to dynamically supply asset IDs on keyword replacements. This keyword replacement takes the following format:

	%assetid_keyword^as_asset:asset_keyword%

This effectively allows you to print the asset information of any asset (whose ID can be retrieved). For example, you may want to display the delivery address of an e-commerce order. You can use the order number keyword replacement to print this information, as follows:

	%order_number^as_asset:asset_attribute_delivery_addr%

Proxy Support for the Funnelback Search Page [ Feature Request #4654 ]
-----------------------------------------------------

Previously, a Funnelback Search Page would return an invalid response when trying to retrieve data from Funnelback using a proxy server:

	Invalid response from the Funnelback server [FNB0002]

This feature adds proxy support to the search page, allowing users on a proxy to connect to the Funnelback server.

Caching 301 Permanent Redirects in the Remap Manager [ Feature Request #4626 ]
-----------------------------------------------------

An enhancement has been added to MySource Matrix's Remap Manager so that cache headers are sent for 301 permanent redirects. This can improve performance in the occasion that the browser does not cache the redirection, preventing the same request from being sent multiple times.

This feature was kindly contributed by MySource Matrix Forum user ndrw.

Best Bets and Contextual Navigation Supported for Funnelback 9.1 [ Feature Request #4662 ]
-----------------------------------------------------

The release of Funnelback version 9.1 saw a couple of significant name changes:

    * Fluster to Contextual Navigation
    * Featured Pages to Best Bets

This small enhancement to Matrix updates the tag names for these features to support their functionality in this version.

No Follow Links on Calendar Pages [ Feature Request #4607 ]
-----------------------------------------------------

Web crawlers can sometimes cause sites to struggle in MySource Matrix, traversing large numbers of pages associated with event calendars. This performance reduction is mostly due to the next/previous links on week and month views.

This minor enhancement adds a 'nofollow' relation on these links. This will prevent robots from following the next/previous links, eradicating the performance problems on such calendars.

Improved Handling of Typographical Errors in Layouts [ Feature Request #4613 ]
-----------------------------------------------------

Sometimes MySource Matrix will find typos in the layout of an asset, for example, (rather than ). Usually, in this case Matrix's asset_edit_interface would return an exception, as it could not find the appropriate metadata screen. In some situations however, the system will be stuck in an infinite loop, constructing the xml of the screen interface and flooding the error log till the system times out.

This minor enhancement improves the handling of such errors, so that these rare error loops do not occur.

Added MIME Type For HTC File in Standard MIME Type List [ Feature Request #4519 ]
-----------------------------------------------------

The correct MIME type for HTC files (html component) should be text/x-component. This has been added to Matrix standard MIME type list in order to serve the file correctly before it goes Live.

Redirect Page Errors Display Asset ID [ Feature Request #4626 ]
-----------------------------------------------------

Previously, when getting errors from a redirect page that does not have an asset to redirect to, the error given in the logs does not give the asset ID of that Redirect Asset. If you had many pages in your system, it was difficult to find which Redirect Asset the error came from. This enhancement displays the Asset ID of errors in the log files. 


Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #4370: Backslash in user name won't log in properly
Fixed Bug #4447: backup script not including db dump if you backup to an explicit location
Fixed Bug #4576: Asset builder leaves unwanted link record in sq_ast_link and fails even for non critical trigger action
Fixed Bug #4596: system_integrity_check_indexes.php broken for 3 indexes
Fixed Bug #4599: Multiple calendar assets with different views on one page
Fixed Bug #4602: Safe edit diff preview incorrect highlights
Fixed Bug #4606: Asset listing returns thesaurus tags that don't match listing criteria
Fixed Bug #4609: system_check.php fails with oracle db
Fixed Bug #4611: System Parent Domains
Fixed Bug #4618: Value at a cell disappearing while adding column span via WYSIWYG table properties plugin
Fixed Bug #4625: On a Non UTF8 system special chars not converted
Fixed Bug #4627: Deleting assets under Page Standard will fail if the bodycopy link has a value
Fixed Bug #4632: Cron reports ORA-00932: inconsistent datatypes
Fixed Bug #4633: Notice links don't get registered for Link assets
Fixed Bug #4637: Filesize keywords don't work with the MP3 asset
Fixed Bug #4640: Dynamic Input Screens - Default values
Fixed Bug #4642: Sub menus can be broken when upgrading through 3.24
Fixed Bug #4644: form question rule file type will pick up an empty file in php 5.3
Fixed Bug #4649: set_files_unrestricted.php doesn't change any assets 

Data:
Fixed Bug #4114: Weather Feed fails in 2010
Fixed Bug #4635: XML Datasource concating the recordsets unexpectedly

Web Services
Fixed Bug #4617: Passing an extra attribute into SOAP CreateAsset fails
Fixed Bug #4646: Empty response returned from metadata field containing non-ascii character

CMS:
Fixed Bug #4614: Content file not regenerated for cloned snippets

Search:
Fixed Bug #4572: Matrix Search on a metadata field with the default value %metadata_field_X% fails
Fixed Bug #4600: Structured root node with checkboxes does not refresh results properly
Fixed Bug #4608: Same search page results nested repeatedly when cache on
Fixed Bug #4615: Cloning an Asset doesnt re-index all the components
Fixed Bug #4616: Errors using Search and Replace Tool when search node contains pdf or doc files

Bulkmail:
Fixed Bug #4620: Bulkmail sending multiple emails when additional context added

Import Tools:
Fixed Bug #4621: Bulk File Import Tool doesn't acknowledge .docx files


VERSION 3.28.3

Featured Changes
===================================


Include Summary option in the Insert Link pop up [ Feature Request #4595 ]
-----------------------------------------------------

A new option called Include Summary is now available in the Insert Link pop-up in the WYSIWYG Editor.

When you select this option, the keyword replacement %asset_summary_<assetid>% will be added in the link, where <assetid> is the id of the asset that you have linked to.

This keyword replacement will show the summary of the asset in the frontend and will only work when you create a link to file assets, such as Word documents and PDF files.

You can customise the information that is being shown for this keyword replacement in Global Preferences.


Obscuring the SharePoint System from Users [ Feature Request #4504 ]
-----------------------------------------------------

The SharePoint package within MySource Matrix allows a user to list the documents of a SharePoint server using the SharePoint Saved Search asset. Previously, the URLs of documents returned from these searches were served from the SharePoint server, meaning that the address of your SharePoint system was visible to users when printing the URLs of documents on the frontend. This feature allows the SharePoint Saved Search to download and serve the returned documents directly from your web server.

This option is configured in a new Download File field on the Details screen of the SharePoint Saved Search. When this field is set to 'Yes', the SharePoint documents will be downloaded to your web server, reflected in the document's download_url on its Details screen.

This is a Features Bazaar feature, chosen for development by attendees of the 2009 MySource Matrix User Conference.


Trigger Action: Remove Workflow Schema [ Feature Request #4582 ]
-----------------------------------------------------

A new Trigger action has been added to remove a non-running Workflow Schema on an asset.

This Trigger Action will remove the specified Workflow Schema on the asset that fired the trigger. An option to cascade this removal to all children of the asset is also available.

This new action compliments the pre-existing Set Workflow Schema Trigger Action.


createFileAsset Function for Javascript API [ Feature Request #4561 ]
-----------------------------------------------------

Currently, the Javascript API does not contain any functions allowing users to create File type assets. The feature introduces the createFileAsset function, creating a blank File type asset (PDF File, Image, MP3 etc.) that users will then be able to upload their files to.

The createFileAsset function is enabled through the Create Asset field on the Details screen of the Javascript API.

This function takes six parameters:

    * parentID: asset ID of parent where the new asset will be linked under.
    * type_code: type code of the new asset (defaults to 'File').
    * friendly_name:  name of the asset being created.
    * link_type: type of link to create for File asset (SQ_LINK_TYPE_1, SQ_LINK_TYPE_2, SQ_LINK_TYPE_3, SQ_LINK_NOTICE).
    * link_value: value of the link to create to parent for this new asset.
    * dataCallback: the custom callback function (optional).

The format of the createFileAsset function is shown below:

function createFileAsset(parentID, type_code, friendly_name, link_type, link_value, dataCallback)

For example, if you want to create a PDF File asset, titled 'my-file', the function can be used as follows:

    createFileAsset(100, pdf_file, my-file);

Once the PDF File asset is created, the user can upload their file to the newly created blank PDF File asset.

This function has been added to provide more flexibility for MySource Matrix's integration with the Easy Edit Suite.


Select Any Asset as a Funnelback Collection Source  [ Feature Request #4540 ]
-----------------------------------------------------

Since MySource Matrix's Funnelback package was introduced earlier this year, users have been limited to selecting entire sites when creating collections. This meant that users were not able to index specific sections of their site, often causing unnecessary and lengthy indexing processes.

This feature allows you to now select any asset when creating collections, specifying certain sections of a site to index.

This enhancement will greatly increase the speed and efficiency of Funnelback indexing on your system.

This feature allows metadata keyword replacements to return inherited metadata on alternate contexts.


Keywords on Alternate Contexts Inherit Metadata on the Default Context [ Feature Request #4518 ]
-----------------------------------------------------

By default, on a system with multiple contexts, metadata on alternate contexts which has not been configured will inherit the metadata values of the System's default context. This inheritance, however, was not previously reflected through keyword replacement. Metadata keyword replacements would return no values for metadata fields that had not been manually configured on the alternate context. For example, if you have an alternate context on your system which is inheriting the default context's metadata, keyword replacements such as %asset_metadata_field%, on the alternate context would return a blank value rather than the inherited metadata.

This feature allows metadata keyword replacements to return inherited metadata on alternate contexts.


Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #4598: Squid Cache Source string not found on Usergroup preferences
Fixed Bug #4597: cron_job_metadata_triggers.inc has new line after closing php tag
Fixed Bug #4577: Invalid HTML markup of Forms
Fixed Bug #4583: Menu design area is getting same sub-menu content from cache for all the menu items assets.
Fixed Bug #4592: Special characters in metadata text field default value getting escaped in frontend
Fixed Bug #4591: System Integrity Incomplete Attachment script halts with invalid Asset ID.
Fixed Bug #4579: Duplicate/Mislabeled entries in the "Asset Types to Search for"
Fixed Bug #4580: trigger action set cookie depends on PHP 5.2+ when httponly option is used
Fixed Bug #4539: Unable to list LDAP users under usergroups with Asset Listing
Fixed Bug #4557: Cannot use keyword modifiers on %metadata_field_X% keywords
Fixed Bug #4560: System Move Update script does not take care of filesystem paths in form submissions
Fixed Bug #4554: Relative URL broken after recaching the page
Fixed Bug #4530: Asset Manager's generateGetChildrenQuery() method returns all assets if link tree table is corrupted
Fixed Bug #4544: Metadata Edit Interface Screen can't be accessed in Limbo
Fixed Bug #4555: WYSIWYG Replace Text Plugin clears almost all content
Fixed Bug #4546: Cannot locate LDAP users in asset map with backslash in CN
Fixed Bug #4492: performance issues with generateGetChildrenQuery
Fixed Bug #4543: Asset map show no children assets when a ldap user group is linked outside
Fixed Bug #4536: Insert table function in WYSIWYG generates incorrect HTML resulting in moving headings
Fixed Bug #4531: trigger batch event hipo prints 'Undefined index: percent_done'
Fixed Bug #4523: Asset map does not give 'next' arrows for custom forms
Fixed Bug #4532: system_integrity_recover_file_versions script does not take care of file versioning in public directories
Fixed Bug #4513: metadata context modifier does not return values of correct context

CMS
Fixed Bug #4534: Asset Builder Additional Create Locations: Unable to specify link type
Fixed Bug #4558: Passed by Reference Error In cron_job_manage_incomplete_submissions.inc

Search
Fixed Bug #4527: Matrix search page results has no output for page_list_X keywords

LDAP
Fixed Bug #4542: Missing DN attribute error when LDAP Active Directory is used and one user group is in the member list of another user group
Fixed Bug #4552: creating/deleting links for LDAP user from linking screen throws PHP and MySource notice

Calendar
Fixed Bug #4526: Calendar displays incorrect date when on same page as Upcoming Events List

E-Commerce
Fixed Bug #4503: Ecommerce Rules screen has checkable boxes

Funnelback Package
Fixed Bug #4559: Hitting the enter key in Internet Explorer after entering a search term in Funnelback search page does not returns any result.



VERSION 3.28.2

Featured Changes
===================================

Alternate Video File Configurable for Video File Assets [ Feature Request #4506 ]
-----------------------------------------------------

A new option is available for video file assets to specify a secondary file, allocated as the assets' alternate video source. This file can then be provided as an alternative to users, enhancing the accessibility of the video. For example, if you are using an Ogg video file and you would also like to provide users with the option to download an mp4 version of the video, you can use this attribute to select the mp4 file as the alternate video file for the asset.

The Alternate Video File Asset field is located on the Details screen of the video file. Once set, the alternate video file's attributes can be accessed using the following keyword replacement format:

%asset_attribute_alt_asset_<asset_attribute>%

For example, %asset_attribute_alt_asset_asset_url% will display the URL of the alternate video file.


Disabled SOAP Services Removed from the WSDL File [ Feature Request #4516 ]
-----------------------------------------------------

The SOAP WSDL file contains the complex and simple type parameters for the available functions of a SOAP server. Previously, this file would display parameters based on the SOAP API services that were enabled on the SOAP server. For example, if you had enabled the SOAP API asset service on the SOAP server, the parameters of every function within that service would appear in the WSDL file, regardless of whether or not the functions were enabled on the service. This not only cluttered the WSDL with unnecessary parameters but also allowed users to view the parameters required for functions that were not being used.

This feature hides the parameters of those functions that are not enabled on the SOAP server, cleaning up the WSDL file, making it easier to navigate and more relevant to the SOAP server's configuration.


New Keyword Modifiers: Replace and Contains [ Feature Request #4482 ]
-----------------------------------------------------

Two new keyword modifiers have been added to MySource Matrix: replace and contains.

The replace modifier replaces a string in the returned value using regular expression. The format of this keyword modifier is shown below.

replace:<string>:<replacestring>

Example: We have an asset named 'MySource Matrix'. Using the keyword replacement %asset_name^replace:Matrix:Mini% will print 'MySource Mini' (replacing 'Matrix' with 'Mini').

The contains modifier will test if a specified string appears in the returned value. The format of this keyword modifier is shown below.

contains:<string>
contains:<string>:<YES>:<NO>

Example: We have an asset named 'MySource Matrix'. We can test the recurrences of the letter M using the keyword replacement %asset_name^contains:M%. This keyword replacement will print '2' as the letter M appears twice in the asset name. Alternatively, you can append the YES and NO parameters to the modifier to check if the string appears in the returned value. The keyword replacement %asset_name^contains:Matrix:YES:NO% will print YES.


Funnelback Search Log Report [ Feature Request #4403 ]
-----------------------------------------------------

A new log report asset is now available for the Funnelback Search package, providing statistics of searches on a system. This includes details on the most popular search queries and queries which failed to return any results.

The Funnelback Search log report displays the statistics for each collection on a system, as well as a tally of the system-wide total results.

The log report can be configured to display search statistics on either a daily, weekly or monthly basis, with archived reports available on the asset's Report screen.

Word Logic for Funnelback Search [ Feature Request #4410 ]
-----------------------------------------------------

Word logic options are now available on the Funnelback Search page to allocate whether searched terms should be excluded or included (any or all) from the search results. These settings can be configured on the backend or on the frontend (via user selection).

The Word Logic field, on the Details screen of the Funnelback Search page, allows you to set the default word logic for the search page.

By default, this is Include any, meaning that results will be displayed if containing at least one of the searched terms. The options Include all (all searched terms must be included in results) and Exclude (search results must not contain the search term) are also available.

The %search_logic% and %metadata_logic_X% keyword replacements can be used to display the word logic options on the frontend of your site. This allows users to define the parameters of their search themselves.


Asset Exclusions from Funnelback Indexing [ Feature Request #4474 ]
-----------------------------------------------------

A new Asset Exclusions screen is available on the Funnelback Manager to enable to exclusion of assets during Funnelback indexing.

Assets can be specified for exclusion by Asset ID, Type or Root Node. Please note that these exclusions extend across ALL collections. When an exclusion is added, changed or deleted, you will have to run the rebuild cache and reindexing for Funnelback to acknowledge the changes.

File Upload Questions Available For Ecommerce Form Pages [ Feature Request #4497 ]
-----------------------------------------------------

This feature allows you to use File Upload question types on an Ecommerce Form Page enabling users with the ability to upload a file during their form submission.

The File Upload question type works the similarly to the Custom Form's File Upload question type - For more information, refer to the Custom Form manual (http://manuals.matrix.squiz.net/custom-form/chapters/file-upload-question-type).


Enable Make SOAP Call Submission Action in E-Commerce Form [ Feature Request #4498 ]
-----------------------------------------------------

A Make SOAP Call submission action has been added to the Ecommerce Form Page, accessed on a new Submission Actions screen (via the Ecommerce Form Contents asset).

This submission action works in a similar manner to the existing Make SOAP Call submission action of a Custom Form (see the Custom Form manual for more information), sending a message to a remote SOAP server on the submission of a form. Question keyword replacements can be used in the SOAP request message to set form answers as parameter values.

The parameter values returned from the SOAP call are then stored as global session variables and can be printed using global keyword replacements.

Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #4188: SQ_DESIGN_NAME=system::frontend does not work on Site assets
Fixed Bug #4303: HTTP_Request attribute not calculating cache expiry properly, throws a notice
Fixed Bug #4369: Backslash in user DN can break searches in Search Manager
Fixed Bug #4457: check index script doesn't distinguish between constraints and indexes correctly.
Fixed Bug #4458: Conflicting WYSIWYG's
Fixed Bug #4459: Metadata Triggers Cron Job fails on oracle
Fixed Bug #4460: Putting files in safe edit is losing metadata on live file
Fixed Bug #4472: BodyCopy Code Errors
Fixed Bug #4474: Content-Disposition header on file asset in safe edit contains .ffv[0-9]* in name
Fixed Bug #4492: performance issues with generateGetChildrenQuery
Fixed Bug #4488: Event Manager fails to register runtime event listeners properly
Fixed Bug #4493: Rollback management fails
Fixed Bug #4494: Create Image Variety Trigger: Constrain by options not displaying appropriate fields
Fixed Bug #4499: Log rotation deletes log files that are in use
Fixed Bug #4502: Trigger Action Set Metadata Field Date prints Undefined index: contextid
Fixed Bug #4505: Missing valid permission throws an undefined index on permission change script
Fixed Bug #4430: Thesaurus Terms 'Update this term system wide' Issue
Fixed Bug #4468: Embed Movie functionality not working within WYSIWYG
Fixed Bug #4475: WYSIWYG throws Unknow toolbar item 'addkeyword' FIXME error
Fixed Bug #4476: WYSIWYG HTML Tidy requires extra commit to complete tidy

CMS
Fixed Bug #4441: Asset Remote Content Page breaks if the webpage being accessed has <noscript> tag with redirect
Fixed Bug #4462: Unnecessary Screens/Attribute Fields for Asset Listing related assets

Search
Fixed Bug #4443: Search listing breaks with lots of indexed content and certain keywords in that content

LDAP
Fixed Bug #4483: LDAP getChildren() returning the wrong format
Fixed Bug #4514: The Login As feature does not work for Active Directory Users
Fixed Bug #4486: Unable to list LDAP User Groups with Asset Listing
Fixed Bug #4487: LDAP getParents() does not return the LDAP user groups unless the 'user_group' type code is passed.

Calendar
Fixed Bug #4480: Lookups not updated when calendar event deleted via calendar page

News
Fixed Bug #4481: Asset builder with customised layout for comments breaks page rendering

E-Commerce
Fixed Bug #4465: default_delivery_method mutes error when doing require_once HTTP_Client
Fixed Bug #4484: Ecommerce DPS gateway produces Invalid Amount error

Data
Fixed Bug #4463: Undefined offset error in Hit Count Listing Page for A-Z Listing

Web Services
Fixed Bug #4336: Custom form printing keyword when empty in rest submission action
Fixed Bug #4515: No permission to SOAP server sends XML content with HTML headers

Funnelback Package
Fixed Bug #4426: Result Per Page not working in Funnelback search page
Fixed Bug #4469: Add meaningful descriptions to fields on Collections screen of Funnelback Manager
Fixed Bug #4473: In Funnelback, when caching, an entry is created with the wrong root url
Fixed Bug #4510: Quotes not working in Funnelback search query
Fixed Bug #4455: Funnelback reindexer on oracle db breaks if metadata value is over 1000 chars



VERSION 3.28.1

Featured Changes
===================================

Easy Edit Suite Login Design [ Feature Request #4439 ]
-----------------------------------------------------

A new EES Login Design asset has been added to MySource Matrix to complement the new Easy Edit Suite interface, providing a login page that is visually consistent with the EES's sleek MySource Mini-style design.

When no alternate Login Design has been set for a Site using the Easy Edit Suite, the default MySource Matrix login box will be displayed - styled to resemble the system's Administration interface. The majority of users of the Easy Edit Suite will not be familiar with the Matrix backend, so it is important to provide a smooth user experience by creating a consistent look and feel in all aspects of the EES interface. This is helped achieved using the EES Login Design.

The ees_login_design asset is located in the System Designs Folder, under the System Configuration Folder in the Asset Map. This design can be applied on the Settings screen of the Site you have enabled the Easy Edit Suite for. To do this, select the design in the System Defined Login Design field.

Once the design has been committed, the new Login Design will be used for the Easy Edit Suite's login page on your Site. This login page will be displayed when users who are not logged in attempt to access the /_edit interface.


Separate Permission Role and Workflow Role Systems [ Feature Request #4440 ]
-----------------------------------------------------

When enabling Roles on a system, users previously only had the option of enabling Roles on the entire system, meaning that Roles for both Permissions and Workflow were enabled.

As Roles can be quite performance intensive, this feature allows users to enable Roles individually for both Permissions and Workflow. This means that if, for example, only Workflow Roles were enabled, the system's performance would not be affected when dealing with Permissions.

These fields are located on the system's System Configuration screen.


New "userProxy" objectClass Supported in LDAP [ Feature Request #4449 ]
-----------------------------------------------------

Previously, the LDAP package only supported the organizationalPerson and intOrgPerson objectClasses for User objects. This feature introduces the userProxy objectClass, allowing User objects using this objectClass to be expanded in the Asset Map. Such Users would have previously been discarded by the system and excluded from the Asset Map's LDAP tree.


JS API: getChildren() Function Enhancements [ Feature Request #4446 ]
-----------------------------------------------------

Enhancements have been made to the JS API's getChildren() function to return NOTICE linked children in the JS API's response. Previously, NOTICE linked children were grouped as Non-Dependant children.

direct_dependant_child => 1
direct_non_dependant_child => 6

This feature enables the JS API to differentiate between these child types, returning values for both Non-Dependant and NOTICE children, as well as for the Dependant children of the asset.

direct_dependant_children => 1
direct_non_dependant_children => 2
direct_notice_linked_children => 4

These enhancements have been added to provide a more comprehensive response from the JS API, assisting in the development of Phase 2 of the Easy Edit Suite.


Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #4218: Editing an image under a site doesn't preview the image
Fixed Bug #4437: Scripts not escaped from attribute values in Admin Interface
Fixed Bug #4447: backup script not including db dump if you backup to an explicit location
Fixed Bug #4445: Baking asset type specific queries does not work on non-root path
Fixed Bug #4364: Root node asset is put under "Other" in A-Z asset listings
Fixed Bug #4413: Could not locate asset (#nnnnn)
Fixed Bug #4297: Character Encoding Issue With &ouml; characters in "Insert Special Character" button in WYSIWYG
Fixed Bug #4359: asset creation can leave unwanted records on sq_ast_lnk and sq_ast_lnk_tree tables
Fixed Bug #4222: IE8 backend bug with Commit Button Position
Fixed Bug #4376: asset_manager.inc::getAssetURL() does not cache the URL with correct protocol
Fixed Bug #4366: Unable to update link due to database error (Invalid Timestamp)
Fixed Bug #4416: Trigger Execute Database Query fails if there are more then 1 globals keyword used in them
Fixed Bug #4319: expired lock causing error on active locks page

CMS
Fixed Bug #4254: Undefined variable warnings on asset listings when using shadow assets

Search
Fixed Bug #4367: Search list links don't validate
Fixed Bug #4422: "Exclude this asset" option in search page excludes parent assets

Bulkmail
Fixed Bug #4425: Bulkmail Job never completing

Import Tools
Fixed Bug #4434: Ticking 'Import as a Single Page' and 'Fix Anchor Tags and Footnotes' without Anchor Tag in html Raises Matrix Error

Web Services
Fixed Bug #4371: Assets Deleted by web service don't release the URLs

Other
Fixed Bug #3714: Error using Language Character Mapping when creating a new asset
Fixed Bug #4414: Metadata 'Restriction' seems to allow an asset with Required metadata fields to be pushed live
Fixed Bug #4419: Undefined Index PHP Notice on What's New asset



VERSION 3.28.0

Featured Changes
==================================

ALLOW MULTIPLE "asset_contents_paint_#" KEYWORDS IN TYPE FORMAT BODYCOPY [ Feature Request #4347 ]
-----------------------------
When printing an asset in a Listing Engine, the type format only supports one instance of printing asset contents with an arbitrary bodycopy, using "asset_contents_paint_#".
This feature allows multiple arbitrary paint layout keywords be used in the one type format.


ALLOW ACCESS TO ASSET KEYWORDS FROM ALTERNATE CONTEXTS [ Feature Request #4373 ]
-----------------------------
This new keyword feature allows you to draw a keyword replacement from a context other than the currently used one.
The new feature works like a keyword modifier, using the name of the context as its parameter. For instance, %asset_keyword^context:Context_Name%. If a keyword is not contextable, this modifier will have no effect. 


ALLOW ACCESS TO ASSET KEYWORDS FROM ALTERNATE CONTEXTS [ Feature Request #4316 ]
-----------------------------
Allow you to update the status of a Twitter account from a trigger, based on the content of the triggering asset.
Global keywords and keywords of the triggering asset are supported in the Tweet format.
The Set Twitter Status Trigger Action which were added to this release requires the I18N_UnicodeNormalizer PEAR package, version 1.0.0 to be installed.


JS API FUNCTION TO GET APPLIED WORKFLOW [ Feature Request #4395 ]
-----------------------------
Added a JS API function which could return applied/denied workflow schema on a asset.
Alternately we could pass in an extra argument to see if the applied workflow (if any) is currently running on the asset. 


%asset_url_CONTEXT% KEYWORD [ Feature Request #4348 ]
-----------------------------
When a site has multiple URLs with different base contexts, this keyword will only return the asset URL of a Context if that Context is set as a Base Context of the Site URL. 
e.g. %asset_url_Default_Context% will return the asset URL in default context and %asset_url_French% will return the asset URL for French context.   


%globals_context% KEYWORD [ Feature Request #4350 ]
-----------------------------
A new global keyword %globals_context% which returns the name of the current context.


MAKE METADATA SELECTION FIELD CONSISTENT IN DIFFERENT CONTEXTS [ Feature Request #4341 ]
-----------------------------
Assume that you have 2 contexts in your Matrix system, a default context in English and an alternate context in French.
Create a new Metadata Schema with a Selection Field named Title with 2 options in 2 contexts:mr => Mr (English) and Monsieur (French), ms => Ms (English) and Mademoiselle (French) 
This feature will work in a way that if Mr is selected in English, Monsieur would be selected automatically in French.


JS API ABILLITY TO SPECIFY _admin/_edit ACCESS [ Feature Request #4372 ]
-----------------------------
Right now when JS API function call is made it behaves like called in the backend. For example if the status of an asset is changed and if this results in workflow email to be generated, then the links in the email will have _admin links.
This feature allows function call can be made to act as if it was made from Simple Edit Interface. So in the case like above example we could have an _edit link in the emails instead.


HIDE FRAMES IN SIMPLE EDIT MODE [ Feature Request #4347 ]
-----------------------------
In simple edit mode, there is always the top bar frame and side bar asset map frame which is hidden. 
This new option of design asset would allow user to remove this frames completely and only display the main frame. This option is per design.



EXIT DESIGN AREA [ Feature Request #4378 ]
-----------------------------
New design area called "exit". This design area is used when the design needed to stop printing the ignore the rest of the body. Can be used in conjunction with design area if condition.


NEW SOAP AUTHENTICATION FEATURE ALLOW USER TO LOGIN [ Feature Request #4377 ]
-----------------------------
A new API function is added to SOAP Asset Service to allow authentication to MySource Matrix using username and password. Upon logging in, the API function will produce a session id and a session key, which can be used to authenticate cross domain.


DISPLAY KEY OR VALUE OF METADATA SELECTION FIELD [ Feature Request #1404 ]
-----------------------------
New keywords are added to display the key to a selection metadata on one screen and the value on another. The keywords will be %asset_metadata_X_key%  and %asset_metadata_X_value%


ADDITIONAL FEATURES FOR SOAP API [ Feature Request #4307 ]
-----------------------------
A number of SOAP API functions has been added to the web services package. Here is the summary:
Asset service new features:
- Get page content
- Get asset type descendants
- Get assets children, lineages, typecode, name in batch
- Get Asset Urls by root node
Link service new features:
- Get parent assets under particular tree
- Get lineages under a particular root node
File service new feature:
- Get image information: title, size, width, height, mimetype


WYSIWYG SNIPPETS PERFORMANCE ENHANCEMENT [ Feature Request #4127 ]
-----------------------------
Queries related to permission checking when loading Snippet keywords can now be disabled when rended in the drop-down list of keywords shown when printing the WYSIWYG container.
This can provide a noticable performance enhancement. The option to configure permission checking is available under Global Preferences for the Snippet Content Type.


TARGET REMAP URL ON WEB PATHS SCREEN [ Feature Request #4220 ]
-----------------------------
In line with the display in Remap Manager, the asset Web Paths screen now shows the Target URL in the Remaps list.


REFACTORING OF CLEAR CACHE CODE FOR SYSTEM CACHE TYPES [ Feature Request #4243 ]
-----------------------------
Code to handle clearing caches has been moved into the cache type, in order to prevent unnecessary calls to the MySource Matrix database for systems using non-default caching mechanisms such as Memcache.


BULKMAIL ALLOWS MULTIPLE SUBSCRIPTION OF AN EMAIL ADDRESS [ Feature Request #3131 ]
-----------------------------
An "already subscribed" message is sent to users via email, when an email address is submitted to a Bulkmail Subscription Page for which this address already exists on the relevant lists.
This functionality is only available when Subscribe Verification is enabled to the subscription page, and is applicable to both public and Matrix users.


USAGE SCREEN FOR SCHEMAS [ Feature Request #3871 ]
-----------------------------
A "Usage" screen is now available for Metadata and Workflow Schemas, to show where these are referenced in the system. This is implemented similarly to the existing "Usage" screen for Designs.


EXPIRED MATRIX CACHE CRON JOB [ Feature Request #4004 ]
-----------------------------
An "Expired Matrix Cache" Cron Job has been added to clean up expired cache entries on invocation of the Matrix cron script run.php. This is set to every 15 minutes by default on new installations.


ABILITY TO DOWNLOAD CURRENT LOG FROM THE LOG MANAGER [ Feature Request #4267 ]
-----------------------------
A "Download File" button is now available to download current logs (ie; those which have not been rotated).


NEW KEYWORDS FOR DATETIME FIELDS [ Feature Request #4276 ]
-----------------------------
Additional formats are available for Datetime field types which allow these values to be displayed relative to the current date, and with or without a time component.
The keywords to use this functionality are as follows (using %asset_created% as an example):
- %asset_created_relative%     -> "3 days ago"
- %asset_created_relative-dow% -> "5pm on Tuesday"


FILESYSTEM BRIDGE [ Feature Request #4290 ]
-----------------------------
A Filesystem Bridge asset is now available which provides shadow  assets representing a server file system. A path to the filesystem location is provided, and files and directories are represented by Physical File and Physical Folder asset types.
This allows files to be browsed from within MySource Matrix, even though they are not real assets.
An "Import File" tool is also available under Tools, to allow the referenced files to be imported as solid assets into MySource Matrix.


XML/XSL FILE ASSETS [ Feature Request #4291 ]
-----------------------------
XML and XSL File assets are now available. The XML File asset allows an association with an XSL File asset for extensible stylesheet language styling of the file upon preview.


STATUS, PERMISSION AND HIPO SCRIPTS [ Feature Request #4292 ]
-----------------------------
Command-line scripts have been added to manipulate asset status and permissions en masse, as well as to manage running of HIPO Jobs.
The script usage for each is as follows:
php scripts/status_change.php [matrix_dir] [root_node] [status_code] [child_nodes]
-[root_node]   the assetid of the asset from which to apply status changes
-[status_code] a valid status number (eg; 16 for Live etc.)
-[child_nodes] optional and will decend to children if specified as 'y'
php scripts/permission_change.php [matrix_dir] [root_node] [user_id] [permission] [grant] [child_nodes]
-[root_node]   the assetid of the asset from which to apply/deny permissions
-[user_id]     the assetid of the user
-[permission]  specified as either 'read', 'write' or 'admin'
-[grant]       will grant permissions when specified as 'y', deny when specified as 'n'
-[child_nodes] will include child nodes when specified as 'y', or won't (ie; apply only to the root_node) when specified as 'n'
php scripts/hipo_management.php [matrix_dir]
-This script provides user prompts for all operations 


REMAP MANAGER: TOTAL REMAPS [ Feature Request #3432 ]
-----------------------------
The total number of Remaps displayed in Remap Manager is now shown within the list.


REMAP MANAGER: EXPORT TO CSV [ Feature Request #3449 ]
-----------------------------
A "Download File" button is provided within the Remap Manager to export Remap entries to CSV format.


LINK ASSET: ALLOW LINKING UNDER STANDARD PAGE ASSETS[ Feature Request #4281 ]
-----------------------------
Link Assets can now be linked under Standard Pages. 


PASSWORD CHANGE SCREEN: FORCE SECURE LOGIN FUNCTIONALITY [ Feature Request #4306 ]
-----------------------------
The Force Secure Login rules applied to a Site are now respected when a user is presented with a Matrix-generated Password Change screen.


BACKUP SCRIPT: "DATABASE BACKUP ONLY" OPTION [ Feature Request #4310 ]
-----------------------------
A new switch --database-only is available in the Matrix backup script which will create a database dump only instead of a combined database and filesystem backup. 
      

DIFFERENTIATE BETWEEN MATRIX REMAPS AND CUSTOM REMAPS [ Feature Request #474 ]
-----------------------------
A new column "Type" is now available in the asset Remap List and Remap Manager, to denote whether the remap was created by MySource Matrix (specified as "Automatic") or by the user (specified as "Manual").


WHAT'S NEW PAGE: PRE-CONFIGURED TIME FRAMES [ Feature Request #2062 ]
-----------------------------
The Date Range specifications for What's New Page now allows selection from a:
- Fixed date and time (dd-mm-yyyy hh:ii:ss)
- Period relative to the current date and time (x [time period] in the [past/future])
- Period relative to a fixed time on current date (x [time period] [before/after] today at hh:ii:ss) 


JS API: SET ASSET STATUS [ Feature Request #4252 ]
-----------------------------
A new Javascript function has been added to the JS API to set the status of an asset and dependent assets. This status can be optionally cascaded to non-dependent child assets.
E.g. setAssetStatus([asset_id], [status], [cascade], [dataCallback]);
      

JS API ENHANCEMENTS [ Feature Request #4200 ]
-----------------------------
Configurable number of asset levels in call to getParents()
-The getParents() asset function in the JS API has been modified to allow a second argument referring to the number of levels to return, similar to getChildren(). When omitted, or set to 0, all parent asset IDs will be returned. Previous functionality of getParents() was to return only the first level, equivalent to setting levels to 1.
Multiple Set Attribute function
-A new function "setMultipleAttributes()" is now available in the JS API. This function takes a single array of attribute names and their corresponding values to enable updating multiple attributes for an asset in one request. 


JS API: LOOKUPS UPDATED WHEN PERFORMING WEBPATH ACTIONS [ Feature Request #4142 ]
-----------------------------
JS API functions which manipulate or remove asset links, as given below, will update related lookups to ensure these actions are completed in accordance with normal backend operation.
The modified JS API functions are moveLinks(), trashAsset(), removeLink(), createLink().
Implementations should include an "in progress" or spinner device as these actions will take some time to complete and return.


JS API: PROVISION OF ASSET, GLOBAL AND SIMPLE EDIT KEYWORD REPLACEMENTS [ Feature Request #4210 ]
-----------------------------
A new function, getKeywordsReplacements(), has been added to the JS API to return keyword replacements for requested asset, global and Simple Edit keywords.
The function signature is: getKeywordsReplacements(asset_id, keywords_array, dataCallback)


JS API: ASSET LOCK EXTENDED FUNCTIONALITY [ Feature Request #4238 ]
-----------------------------
The asset lock acquisition and release functionality has been improved
- new function getLocksInfo() to return information about locks acquired, the user holding locks, and lock expiry time
- any other error that might have occurred during processing of locks
- locks may be acquired on dependent or non-dependent child assets
- locks can now be forcibly acquired
- new function getLocksInfo() which will return


JS API: UPDATE AND TRASH MULTIPLE ASSET LINKS, GET CHILD COUNT FUNCTIONALITY [ Feature Request #4271 ]
-----------------------------
A new function updateMultipleLinks() has been added, as well as an extension to the trashAsset() function to provide the ability to perform these operations upon multiple assets. The trashAsset() function can still operate on a single asset as given by current functionality.
Link sort order, type, value, and locking can be controlled from the link update functions. Another new function getChildCount() has been included to obtain the number of direct children and/or dependents.


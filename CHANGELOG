MYSOURCE MATRIX CHANGELOG

VERSION 3.26.3

Featured Changes
==================================

Automatic Remaps to use closest available Lookup match [ Feature Request #4217 ]
-----------------------------
Remaps are now selected to more closely match by old URL. Previously remap destination URLs were determined to be the first URL in the lookup.
This new functionality means that remaps should maintain within the same domain, as long as there is a matching URL for that domain. 


Web Paths Screen: Target URL display in Remaps List [ Feature Request #4220 ]
-----------------------------
To retain consistency with Remap Manager, the Remaps section on the asset Web Paths screen now displays the Target URLs within the remaps list.


Additional MIME Types added for Microsoft Office [ Feature Request #4105 ]
-----------------------------
MIME types for Microsoft Office documents, such as those with extensions "docx" and "pptm", have been added to enable these files to be served with the expected type header. 


E-Commerce Order: New Keyword for Order Total [ Feature Request #4248 ]
-----------------------------
A new keyword, %order_grand_total%, has been added to E-Commerce Order assets to expose the total amount of orders on the frontend, and for listing and grouping purposes through Listing Engine. 


Workflow Step: Custom Subject line for Email Notifications [ Feature Request #4268 ]
-----------------------------
The subject line used for workflow notifications can be customised per Workflow Step. The default values for each message type (eg; Invitation Message) is retained from previous releases and will also revert back to this default if left blank.


SOAP API be able to set asset status and create a file asset [ Feature Request #4274 ]
-----------------------------
Additional functionality to create File assets and to set their status.


Link lineage performance improvements part 2 [ Feature Request #4262 ]
-----------------------------
Performance enhancement to remove duplicate asset IDs before being included in an SQL query.
This enhancement was made to lineage code and may be noticed on systems with many links to particular assets.


Custom Workflow Subjects [ Feature Request #4268 ]
-----------------------------
The subject line of Workflow Messages sent via email can now be customised per Workflow Step. The body of these messages (eg; Invitation message) could already be customised here, so this compliments this functionality.


New Trigger Event: Matrix Cache Cleared [ Feature Request #4293 ]
-----------------------------
A new "Matrix Cache Cleared" Trigger Event is available for capture and use in Triggers whenever the cache is cleared on a particular asset.

Please note that this is not available for systems using Memcache cache storage, nor when the cache is cleared by URL or entirely, due to technical constraints with implementing this functionality.


New Trigger Action: Set Standard Asset Date [ Feature Request #4294 ]
-----------------------------
The values for standard asset date fields "Created", "Last Updated", "Published" and "Status Last Changed", may be set from within a Trigger to a fixed value or the time the Trigger was fired. One-minute resolution is provided for each of these values.



Additional Changes and Bug Fixes
===================================

Fixed Bug #3653: Safe edit on css files and __data URLs
Fixed Bug #3918: PHP notices from invalid apparent keywords in metadata
Fixed Bug #4138: Non contextable metadata value is broken when applied before a context is added
Fixed Bug #4150: JS API: Content length error when posting data in FF 3.0.17 and 3.0.15
Fixed Bug #4157: JSAPI acquireLocks() returns success for incorrect screen names
Fixed Bug #4162: Values broken when special characters are used
Fixed Bug #4165: The use of substr on values/contents breaks multi-bite
Fixed Bug #4169: recreate_link_tree script not working in postgres
Fixed Bug #4183: Metadata indexing is not context aware
Fixed Bug #4184: When wysiwyg contians bulkly content and that can potentially cause many HTML Tidy errors, commiting it can stall Matix forever
Fixed Bug #4185: Uncustomising format for sections does not work
Fixed Bug #4186: IE6 Calendar CSS bug
Fixed Bug #4191: Apache Configuration screen doesn't save input
Fixed Bug #4201: Asset listing ignores user group restrictions
Fixed Bug #4202: Upwards direct asset listings use incorrect permissions
Fixed Bug #4209: Logging into Matrix via HTTP authentication not working
Fixed Bug #4226: Shadow assets should not be cascaded status change when workflow applied to parent
Fixed Bug #4231: TRIM saved search, incorrect php warning shown where it shouldn't be
Fixed Bug #4232: Custom Form - Complex Validation Rules - Spelling mistake in "Note:"
Fixed Bug #4239: JS API not handling '?' characters
Fixed Bug #4240: Some assets unable to be indexed by Funnelback with UTF8 metadata
Fixed Bug #4242: Using db connector in 'Run db query' in form submission action will throw error
Fixed Bug #4249: Radio buttons cleared after Save & Exit
Fixed Bug #4253: No type checking on picking a collection 
Fixed Bug #4257: Cannot create assets in alternate context
Fixed Bug #4259: DB data source asset creates many empty record sets for a update query
Fixed Bug #4261: Funnelback Sitemap Generation fails on Oracle
Fixed Bug #4272: Remap Manager Scalability issue
Fixed Bug #4278: Last Modified headers: not taking into account child assets
Fixed Bug #4283: Error uploading CSV to empty remap manager
Fixed Bug #4284: More/less links do not work
+ (Core) Check Requirements Script: Ability to check executables with path component [ Feature Request #4233 ]
+ (Funnelback Search Page) %spell_suggestion% should be included in the No Results Page Layout [ Feature Request #4296 ]



VERSION 3.26.2

Featured Changes
===================================

Funnelback Search integration [ Feature Request #4214 ]
-----------------------------
MySource Matrix has been integrated with purpose-built Funnelback binaries, for indexing and searching of content housed in a MySource Matrix system.

Searches are performed against Collections, which are linked to MySource Matrix Site assets, and Meta-Collections which comprise multiple Collections (ie; for searching more than one site at a time). Configuration of Collections, Metadata mappings and indexing are performed under the Funnelback Manager asset.

The Funnelback Search Page asset has been expanded to include bodycopies for Contextual Navigation, Type Formats (HTML, PDF etc.), Featured Pages and spelling suggestions.

Funnelback search integration is performed through interaction with external binaries. These are included within MySource Matrix SSV for configuration during installation or upgrade.

Search indexing functions differently to MySource Matrix Search, in that content is not immediately indexed when updated. Scripts are available within the Funnelback package which can be added to the cron to update the index periodically. The frequency at which the indexer should be run is dependent on the amount of content being indexed and the dynamic requirements of this content. Collections can be reindexed independently of each other.

The MySource Matrix search system is still required for items such as backend search. 


TRIM Saved Search enhancements [ Feature Request #4180 ]
------------------------------
Searches can now be restricted by TRIM Classification may be specified to restrict search results to an exact classification (eg; Projects) or a classification and its sub-classifications (eg; including Projects - MySource Matrix).

Data Source elements are provided for to expose TRIM Classification elements and each classification portion (eg; Projects, MySource Matrix, Projects - MySource Matrix), for listing and grouping purposes.

TRIM Date values stored in UTC (GMT) format can be converted to the timezone of the Matrix system upon returning the record set. This is provided as an option from the TRIM Saved Search asset.

The Record Type value returned in record sets previously returned a number representing that type. The Record Type is now converted to a textual representation from TRIM, providing text such as "DOCUMENT" instead of the numeric format.


TRIM Record Type filter [ Feature Request #4224 ]
-----------------------
A Record Type Filter is now available in the "General Search Options" of TRIM Saved Search assets to restrict retrieved records to particular TRIM Record Types.

As record types can be custom-built, a list of these are retrieved from the TRIM server when synchronising the Saved Search page, which are then available for selection.

For example, a saved search may be configured to return "Document" types, or both "Document" and "Folder" types. 

      
Date/Time Keyword Modifier [ Feature Request #4181 ]
--------------------------
A new Keyword Modifier, "date_format", is available to format asset attributes which provide a UNIX timestamp. One argument is required to define the PHP date() format used for display.

For example, %asset_created^date_format:Y% will print the four-digit representation of the year in which the current asset was created.



Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #3889: remove_internal_messages.php script does not delete messages / gives error
Fixed Bug #4175: Status Simple Edit Keywords Don't Display
Fixed Bug #4178: Link to asset's workflow screen in workflow escalation message is malformed in dependent assets
+ New system events to broadcast update of lookups and permissions [ Feature Request #4208 ]

Calendar
Fixed Bug #4189: Creating New Dates on Multi-Date Calendar Events does not work with Assets in Workflow

CMS
Fixed Bug #4166: asset_contents keyword in asset listing's type format cannot process modifiers
Fixed Bug #4173: Asset listing may display group name as '0'
Fixed Bug #4174: Asset Buider - Required Metadata Date Field doesn't validate
Fixed Bug #4197: Unable to deactivate Form submission actions
Fixed Bug #4199: Listing engine throws an error when expected structure does not exist
Fixed Bug #4205: Form submission asset throws error if accessed in edit mode

Web Services
Fixed Bug #4204: JS API not handling '#' characters




VERSION 3.26.1

Featured Changes
===================================

JS API: Multiple Set Metadata function [ Feature Request #4128 ]
--------------------------------------
A new function "setMetadataAllFields()" is now available in the JS API. This function takes a single array of field ids and their corresponding values to enable updating multiple fields for an asset in one request.

This provides performance gains over using multiple "setMetadata()" requests. Locks are acquired once and the Metadata Content is generated once for the asset instead of once per field. This function returns TRUE on success and FALSE on failure (eg; when failing to fill in a required field).


Reindex Assets script: Specification of multiple Root Asset Nodes [ Feature Request #4130 ]
-----------------------------------------------------------------
The command line script packages/search/scripts/reindexSearchIndex.php now allows multiple Root Nodes to be entered for reindexing.

The script can now be used as follows:

	$ php packages/search/scripts/reindexSearchIndex.php `pwd`
	Enter the #IDs of the root nodes to reindex (space separated)
	or press ENTER to reindex the whole system: 123 456 789

A prompt will appear to confirm reindexing of each specified node.


Listing Engine: Group by Asset Keyword [ Feature Request #4153 ]
--------------------------------------
A new option is available in Listing Engine assets such as Asset Listing and Search Page, to provide grouping by keywords.

Like existing grouping options, this can be configured from the Asset Grouping screen of these assets. The keyword used for the grouping is supplied without leading or training percentage (%) characters.


TRIM Saved Search: Custom Metadata Fields and Search Logic [ Feature Request #4155 ]
----------------------------------------------------------
TRIM Saved Search assets now allow queries on custom TRIM metadata fields and allow boolean search logic between these terms to be defined.

A set of known metadata fields which is shipped with TRIM are the TRIM Saved Search options by default. This can be expanded by requesting all available fields from the TRIM system, for use in search queries. A "Retrieve Now" button is available from the Details screen to retrieve these fields.

The Search Logic and Result Fields are expanded, and are configured from the Details screen. The layout is similar to that provided for Search Page assets. Fields may be grouped with a boolean operator, and each group is joined by another boolean operator.

For example:

	Group 1:
		- Search field "AnyWord" for value "Fred"
	[ AND ]
		- Search field "Title" for value "Test"

	[ OR ]

	Group 2:
		- Search custom field "Status" for value "Yes"

Groups may be joined only by one common boolean operator, and "NOT" logic is unavailable.

Just like the Search Logic, Result Fields may be composed of standard or custom fields, or both.


Asset Manager lineage listing performance enhancement [ Feature Request #4160 ]
-----------------------------------------------------
A performance enhancement may be evident on systems with large asset trees and/or many links pointing to a particular asset.


Matrix Backup Script: Suppression of minor notices [ Feature Request #4158 ]
--------------------------------------------------
Minor notices such as "file changed as we read it" are now suppressed, to avoid these being sent by email from backup routines scheduled by cron.



Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #3717: New version of backup.sh fails with Postgres 8.3
Fixed Bug #3927: Form email address question throws error for public user
Fixed Bug #4098: Remaps can be deleted from asset Web Paths screens regardless of Never Delete setting
Fixed Bug #4099: Trigger will remove remaps even if "Never Delete" option is selected for that remap
Fixed Bug #4102: System Maintenance: Total Assets Report incorrect
Fixed Bug #4109: Undefined index: message_reject
Fixed Bug #4118: Reports and Maintenance Tasks : Rollback Report, logic incorrect
Fixed Bug #4139: Moving asset onto itself or under itself prompts warning and places into trash
Fixed Bug #4141: Script import_asset_csv_to_matrix.php does not alter edited attribute values
Fixed Bug #4143: Typo in File asset's details screen
Fixed Bug #4149: Deleting contexts leaves records for the contexts on db
Fixed Bug #4161: Edit operations import new assets in import_assets_csv_to_matrix when a Metadata Field is chosen for the unique identifier
Fixed Bug #4167: Attaching thumbnail through Details screen does not work in 3.26.0 (?)
Fixed Bug #4168: Typo on User Group asset User Preferences screen
Fixed Bug #4171: Asset Logs screen shows PHP Notice immediately after truncating Internal Messages table

CMS
Fixed Bug #4119: Cloning a form new links the submissions from the old form

Data
Fixed Bug #4113: XML Data Source throws "XML error: XML_ERR_NAME_REQUIRED" when source XML contains XML entities

Search
Fixed Bug #4122: Empty search and synonym search cause php warning
Fixed Bug #4136: Inserting value larger than 4000 characters into search index table in Oracle system throws db error

TRIM
Fixed Bug #4151: TRIM form submission action author always uses user id 1 for 3.26

Web Services
Fixed Bug #4123: Javascript API not handling UTF-8 extended characters in Internet Explorer
Fixed Bug #4126: JS API Key changed on upgrade
Fixed Bug #4129: Javascript API not handling '&' characters
Fixed Bug #4145: JS API not maintaining link values when moveing and creating




VERSION 3.26.0

Featured Changes
===================================

Bundle assets
-------------
Bundle assets allow a group of assets to be taken into Workflow and approved in batches. This asset can be found under the "Schemas" sub-menu in the Asset Map.

"Under Construction" assets without an associated Workflow Schema which are linked under a Bundle, will be set to "Live" when applying for approval. Other assets will follow the next logical Workflow process.

Bundles also have support for Workflow Streams - users have access to any stream they would have access to under at least one bundled asset.


TRIM 6.2 compatibility
----------------------
All functionality provided by the TRIM Package is now compatible with TRIM 6.2. In addition to this, Search and Form posting access can now be provided to non-admin TRIM users who have the appropriate grants. The TRIM Connector supports connections over proxies, determined either from the Matrix Proxy Configuration, or an alternate one specified in the Connector itself.


Matrix System Check script
--------------------------
A test suite to identify system integrity issues on a Matrix System has been added to the "scripts" directory. The script "system_check.php" will run tests which will report on any known inconsistencies in the system. This script will not resolve any issues, so the results must be interpreted and the appropriate action taken.

The script is executed as follows:

	php scripts/system_check.php [ARGS]

	Where [ARGS] can be:
		--system=[MATRIX_ROOT] The path to the matrix system
		--verbose Show more detailed errors
		--colours Use colours
		--stats Show statistics for this process
		--help Show this help screen


Check Indexes System Integrity script: Alter Table for incorrect primary keys
-----------------------------------------------------------------------------
Additional checking has been added to this script to verify that primary key constraints are named as expected. For example, "ast_pk" for the sq_ast table. Corrective database queries will be displayed during the script run which must be applied manually.



Additional Changes and Bug Fixes
===================================

Core
Fixed Bug #4075: System Maintenance: Trash Age Report JS Error
Fixed Bug #4082: Set Workflow Schema' Trigger Action 'Automatically cascade this schema to newly-linked children' setting won't update
Fixed Bug #4084: Remove self links functionality not working correctly
Fixed Bug #4086: Set value in this context always defaults
Fixed Bug #4091: Remap Manager: Remaps have no apparent sort order
Fixed Bug #4095: Email format: attribute edit params have no effect
Fixed Bug #4103: Keyword Modifiers: Not working within paint layouts
Fixed Bug #4108: "Active Locks" show all locks in the system
Fixed Bug #4111: Public user refreshes custom form with a file upload question will get form error
Fixed Bug #4115: Source code preview syntax error

Calendar
Fixed Bug #4073: Wrong time / date for the end date of an event
Fixed Bug #4101: Month view displaying wrong URLs for days
Fixed Bug #4104: Cloning multi-date calendar event assets removes the webpath of each event instance

CMS
Fixed Bug #3956: SQ_ prefixed HTTP GET variables cached as pagination links in Asset Listings
Fixed Bug #4088: Multiple exclude root nodes on an asset listing only applies first selection

Data
Fixed Bug #4065: Commit XML data source gives error "Fatal error: Argument 1 passed to Data_Source::setResultSet() must be an array..."
Fixed Bug #4078: Using non-default xml entities like &nbsp; &copy; in xml feed in XML Datasource throws error

Search
Fixed Bug #4074: Search keywords with silent characters doesn't returns result in Oracle
Fixed Bug #4090: Search Manager does not respect Asset Weight priority when indexing




VERSION 3.26.0 RC1

Featured Changes
===================================

Workflow Streams
----------------
This functionality allows multiple sets of Workflow Steps per Workflow Schema, and allows Administrators to select which of these sets is to be used for any given Workflow process.

Please note that new and existing Workflow Schema steps will be moved under a "Default Stream" which resides under the related Workflow Schema. This Default Stream cannot be moved or deleted. 


Replace Keywords option in Set Value Trigger Action
---------------------------------------------------
A checkbox "Replace keywords in the set value" is provided in the Set Metadata Value and Set Attribute Value Trigger Actions to indicate whether keywords supplied in these fields are to be replaced upon evaluation rather than being treated as literal text. This can be used with both asset-level and Global Keywords.


Public User Trigger Condition
-----------------------------
A Trigger Condition has been added to evaluate whether or not the user who caused the associated Trigger to fire was the Public User (ie; not logged in). 


Asset Lineage Design Area: Negative Start Level definition
----------------------------------------------------------
The attribute value for "start_at_level" can now be specified as a negative number to refer to direct parent assets of the current asset.
For example, -1 would refer to the direct parent, -n to the nth direct parent. Other positive numbers (0 = current asset, 1 direct child etc.) still continue to function as previously defined. 


Additional Asset Keyword Modifiers
----------------------------------
New Keyword Modifiers have been added, which are:

	- md5 (return the computed MD5 hash of the value)
	- sha1 (return the computed SHA1 hash of the value)
	- stripdecl (strips an XML declaration <?xml ... > from the value)
	- number_format (formats a number with grouped thousands and rounded to x significant digits, defaulting to 0)

Some examples:
	%asset_name^md5% (eg; fred becomes 08b622ddf7eb7c8e44cdb3bd6362f966)
	%asset_attribute_price^number_format:2% (eg; takes 1.235 and shows it as 1.24) 


PayPal Payment Gateway modifications
------------------------------------
The PayPal Payment Button asset now supports "Donate", "Add to Cart" and "View Cart" button types, in addition to "Buy Now". The options for each Button Type are available by toggling the Button Type from the "Details" screen and clicking "Commit".

	- Donate Button
	This button allows the name of the Organisation or purpose of the donation to be supplied, as well as the ability to specify a fixed amount.

    - Add To Cart and View Cart buttons
	This allows for cart-based transactions to be maintained by the PayPal environment. The "View Cart" button provides an option to open the cart contents either within the current browser window/tab or in a new window/tab.

	- PayPal IPN Receiver modifications
	This asset has been modified to accept the "Cart" transaction type and to populate the receipt of the generated PayPal Order. 


Move Assets Script enhancements
-------------------------------
The Create Links HIPO Job is now used in this script to perform "move" operations, rather than direct asset manipulation. 


System Update Lookups Script: Increased Verbosity
-------------------------------------------------
The system_update_lookups.php script now supports an optional "--verbose" argument to display any errors which may occur as a result of updating lookups. The script can now be executed from the Matrix System Root directory as follows:

	php scripts/system_update_lookups.php . 123 --verbose


Globals Site Keywords performance enhancement
---------------------------------------------
Modifications have been made to the Matrix core to provide improvements in the evaluation speed of %globals_site_..% keywords and when site-based options are selected from the Parameter Map. 


Get Lineage performance enhancement
-----------------------------------
Instead of loading each asset in the lineage to determine whether they are in Safe Edit, this is now only performed upon assets in the lineage which are in Safe Edit. This should show a slight improvement on the initial load on long lineages with many assets not in Safe Edit. 


Purge Trash HIPO performance enhancement
----------------------------------------
A query has been optimised in the Purge Trash HIPO to return assets in "sort order". This modification removes the need to update the sort order of nearby assets, which may result in a performance increase when running this HIPO.

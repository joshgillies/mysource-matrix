MYSOURCE MATRIX CHANGELOG

VERSION 3.22.1

Featured Changes
-----------------------------------

New Default System Encoding for new installations
	New installations beginning from 3.22.1 have a default System Encoding of "utf-8" instead of "iso-8859-1" which was the case in previous releases. The System Encoding can be configured from the main.inc file during installation.


Send Email Trigger Action: Support for sending assets
	The frontend contents of an asset, along with a selected design or Paint Layout, can now be sent via email from this Trigger Action instead of the supplied bodycopy.


Text Direction option for Bodycopy DIV and Table elements
	An option has been added to the "DIV Properties" and "Table Properties" bodycopy icons (at table, row and cell level) to control the text direction HTML attribute for these elements. This feature provides support for both left-to-right and right-to-left languages on the same page. 


MIME Type and Virus Check Rule modifications for File Upload Form Questions
	A new File Question rule "Uploaded File Virus Check" has been added to scan the uploaded file via the ClamAV third-party utility as configured in "External Tools Configuration". This rule will prevent the file from being uploaded to the form should a virus be detected by the scanner. Custom text may be supplied to indicate the progress of virus scanning and to report scanning failure to the page.

A MIME Type check option has also been added to the "Uploaded File Type" question rule to ensure that the file data supplied matches that expected by the file extension.


Language Character Mapping for Web Paths
	A new option, "Use Language Character Map", has been added to System Configuration to provide character conversion for Web Paths for languages other than English. A set of Polish characters and closest English equivalents has been included and is installed by running step_03. This generates a new configuration file named lang_char_map.inc.

When enabled, the "Use Language Character Map" option will perform a character conversion for the current System Country (as set in System Configuration) which will affect the Web Paths of newly-created assets.


Access History persistence across sessions and Asset Keyword extraction
	The Access History Design Area can now store asset visits by a user in the database for persistence across sessions. This is done by configuring a new attribute "store_permanent" as follows.

	<MySource_AREA id_name="back_to_pages" design_area="access_history">
		...
		<MySource_SET name="store_permanent" value="true" />
		...
	</MySource_AREA>

Furthermore, all asset-level keywords can now be printed within the <MySource_AREA>. For example, the following structure would be used to print the Email Address of User assets:

	<MySource_PRINT var="keyword_asset_attribute_email" /> 


Additional Changes and Bug Fixes
-----------------------------------
Core
Fixed Bug #3629: Turning off Require Secure Login doesn't turn it off
Fixed Bug #3635: 2 CCS File assets in the list on asset is of type trigger condition
Fixed Bug #3643: Thesaurus Term with trailing space doesn't display in Metadata selection interface
Fixed Bug #3661: Custom form rule (check file type) can be skipped
Fixed Bug #3662: File virus check in creating a file will get errors if the file has a path which contains space
Fixed Bug #3663: Selecting asset id for purge trash root node not working
Fixed Bug #3664: backup.sh script fails under Solaris 10
Fixed Bug #3665: session_cleanup.sh script fails under Solaris 10
Fixed Bug #3667: In wysiwyg upload image popup, incorrect error message for uploading a virus infected file
Fixed Bug #3669: Set Future Lineage Trigger issue
Fixed Bug #3673: backup.sh creates schema-only db backup
Fixed Bug #3674: Keywords in the email sent by page_password_reset not replaced in emails
Fixed Bug #3683: External tool config virus check path can not be set if HTML tidy is not turned on
Fixed Bug #3685: File type check question rule in custom file will incorrectly check file type for second file upload
Fixed Bug #3686: Antivirus external tool doesn't even report virus on a properly setup Clam AV
Fixed Bug #3687: File assets fails to reacquire public URL after return from safe edit successfully
Fixed Bug #3691: %workflow_user% keyword not replaced in workflow screen

Bulkmail
Fixed Bug #3660: Bulkmail user linked under unsubscribed users when already subscribed

CMS
Fixed Bug #3619: Reset button on custom form does not work
Fixed Bug #3648: sq-form-field XHTML validation error
Fixed Bug #3656: Link Manager page doesn't recursively update lookups
Fixed Bug #3659: 'Multiple Page' cloning loses 'Multiple Page Page' web paths
Fixed Bug #3675: Tagging screen for Multiple Page Pages
Fixed Bug #3693: Account Manager Page Errors
Fixed Bug #3699: Save XML form action: where multiple optional file uploads, asset ID incorrect
Fixed Bug #3700: Save XML form action: File Upload's file content dump fails when filename is not webpath safe

Calendar
Fixed Bug #3639: A no results bodycopy of a calendar page doesn't display on a page when there is no events to list

Search
Fixed Bug #3679: Asset ID of newly created asset is not indexed

Web Services
Fixed Bug #3650: Web paths screen of SOAP API Asset Service throws fatal PHP error



VERSION 3.22.0

Featured Changes
-----------------------------------

Default Memory Limit and Roles Settings changed for new installations
	New installations beginning from 3.22.0 now have an increased memory limit default of 64Mb for Cron and Web processes. This will not modify any stored values for systems during upgrades - this is just for fresh installations.

The Roles system is also disabled by default for increased performance. This can be enabled from System Configuration in the backend to provide Roles functionality.


Image-based Keyword Replacement for User Email Address
	A new keyword added to User asset types, %asset_attribute_email_image%, can be used to display the email address of users as an image.
The font, colour and font size used for these images is configured under the "User Preferences" section of the "Global Preferences" screen (under System Configuration). User-specified fonts can be installed in "core/lib/fonts" which will then be available for selection.


User-defined Matrix Log Rotation time
	The rotation of Matrix log files, as performed by the Cron Manager, can now be configured to occur at a predetermined time. The Log Rotation time is configured from the "Options" screen of Cron Manager, the default setting of which is 1:00am. 


Listing Engine: Dynamic number of results per page
	Support for Matrix keywords has been added to the "Assets Per Page" option in Listing Engine-based assets such as Asset Listing and Search Page. This allows for control of the number of assets listed per page from other assets or from HTTP GET variables, for instance.


Remove Web Paths Trigger Action
	This new Trigger Action will remove a single Web Path from a specified asset when executed. Global and asset-level keywords may be used as the Web Path specified in the Trigger Action.

Two options are available to control Web Path operations - both of which are disabled by default:
  - Delete all Web Paths (for the specified asset)
  - Update lookups for children


"Update Child Lookups" option added to Add Web Paths Trigger Action
	In order to unify the functionality of Add and Remove Web Paths Trigger Actions, an "Update lookups for children" option, as mentioned above, has been added to the Add Web Paths Trigger Action. 


Video File asset
	A new Video File asset, graciously contributed by Nic Hubbard, has been added to the Matrix core. Like the MP3 File asset, this asset uses the getID3 third-party application.

The supported video extensions are:
  - mov
  - avi
  - wmv
  - asf
  - flv
  - mp4
  - m4v
  - mpg
  - mpeg

Video metadata is extracted by getID3 upon upload and these can be overridden and extracted again from the 'Details' screen.

The Bulk File Import Tool has also been amended to automatically create Video File assets when uploading files manually or from the server which match any of the supported file extensions.


SSL Accelerator Support
	Matrix can now determine whether it is behind an SSL accelerator proxy, based on the origin IP address (whether they are being forwarded through the router), header matching (exact match on header name and value), or both. This is needed because SSL accelerators provide a standard HTTP connection with Matrix, and Matrix needs to ensure that it still sends HTTPS links regardless.

SSL accelerator support can be configured through the "Proxy Configuration" screen of System Configuration. A "Force Insecure (HTTP)" option has been added to the SSL options on the asset "Settings" screen in order to instruct Matrix to provide only HTTP links or nothing for a certain asset.


Additional Changes and Bug Fixes
-----------------------------------
Core
Fixed Bug #3566: Fail to create cron job with set future status trigger
Fixed Bug #3582: Unable to select asset to remap to when deleting asset using linking page
Fixed Bug #3592: Email messages have an extra / in the asset URL
Fixed Bug #3597: "Simple edit user" cannot preview image in the "Insert Image" screen in the WYSIWYG
Fixed Bug #3599: Refresh Cache screen won't refresh all assets
Fixed Bug #3601: replace_url.php doesn't replace __data URLs when host name of new URL is different
Fixed Bug #3602: Site Map excludes assets with Public Read when viewed as a Backend User 
Fixed Bug #3603: Workflow schema with no steps result in fatal error
Fixed Bug #3625: When any of the File assets are cloned, it doesnt have webpath
Fixed Bug #3637: Run Tidy Script not backported to binary Tidy
Fixed Bug #3641: Tidy not enabled gives a status of pass 
+ Future Permissions Section relocated to bottom of the asset Permissions screen

Bulkmail
Fixed Bug #3540: Bulkmail cron job does not send bulkmails
Fixed Bug #3593: Bulkmail Job cannot be scheduled for large recipient groups

CMS
Fixed Bug #3452: Asset Statuses to List field for listing engine will lose value when changing status
Fixed Bug #3605: Nestings with paint layout set not working in simple edit
Fixed Bug #3609: Cannot unselect asset status from Asset Statuses to List in Asset lisiting and Search page
Fixed Bug #3610: Save XML does not work when using weird characters 
Fixed Bug #3616: Form sections do not copy correctly between sections
Fixed Bug #3620: Text wrong on the Form Contents screen of form contents asset
Fixed Bug #3630: form_summary keyword does not work on confirmation screen
Fixed Bug #3636: Adding multi level sections on a form causes PHP errors
Fixed Bug #3642: Form Action Save XML doesn't handle all cases of &'s

E-Commerce
Fixed Bug #3626: Ecommerce form permission problem for placing first order

Search
Fixed Bug #3595: WYSIWYG metadata default values not indexed
Fixed Bug #3596: Restricted metadata type default values indexed by search



VERSION 3.22.0 RC1

Featured Changes
-----------------------------------

Prevent Remaps from being deleted
	A new column has been added to remap entries in Remap Manager to lock entries to prevent accidental deletion. Once locked, an entry cannot be deleted (via the "Delete" checkbox) until that entry is unlocked.


Workflow emails suppressed for dependent assets if not linked in multiple locations
	Workflow emails (eg; notification, approval etc.) are only sent for dependent assets (eg; Bodycopy DIVs under Standard Pages) when these assets are linked in multiple locations.


Customised Caching by specific Root Node and/or Asset Type
	This new feature allows caching to be configured for nominated parts of the system. Two new screens have been added to Cache Manager - "Root Node Specific" and "Type Code Specific" - the latter which replaces the "Cache Expiry" screen.

Cache settings can be configured to propagate to child assets when specifying a root node to customised on the "Root Node Specific" screen.

Root Node and Type-Code Specific settings operate independently of the "Caching Status" as set on the "Details" screen of Cache Manager. "Type Code Specific" configuration options will take precedence over "Root Node Specific" configuration options where applicable.


"Add Web Path" Trigger Action: Lowercase webpath option
	A new option has been added to the "Add Web Path" Trigger Action to transform the supplied web path to lowercase before creating the web path.


Recache Option operation dependent on presence / absence of trailing slash
	The operation of the "_recache" suffix has been modified to re-cache only content with or without a trailing slash. For example, the URL http://example.com/page/_recache in the browser will re-cache the URL http://example.com/page (as the typed URL does not contain a trailing slash). The URL http://example.com/page/ (with trailing slash) will not be re-cached in this instance 


New Global Keywords for Random Number Generation
	Two new Global Keywords, %globals_random% and %globals_random_MIN_MAX% have been added to allow generated random numbers to be used in content. The "MIN" and "MAX" in the %globals_random_MIN_MAX% keyword refer to whole numbers. For example to generate a standard dice roll, the appropriate keyword would be %globals_random_1_6%


Listing Engine: Asset Contents Paint Layout keyword modification
	The %asset_contents_paint_[PAINT LAYOUT NAME]% keyword which paints the listed asset using the specified Paint Layout (functionality introduced in MySource Matrix 3.18.8) - has been expanded to allow the asset ID of a Paint Layout to be used instead of its name. 


Set Cookie Trigger Action
	A new Trigger Action has been added to allow a cookie to be set by name. Further attributes to restrict the cookie by domain, path and duration are available in this action.

The cookie "value" can be specified from the Parameter Map (ie; set from the value of a GET variable or Asset Keyword etc.)


SOAP API: Simple Restricted Types in WSDL
	Simple restricted types can now be added and passed in WSDL. Enumerations and restricted input value by pattern elements are supported. These data types can be nillable (empty without causing validation errors) and allow passing of multiple complex elements. Instructions on how to build or use a SOAP API for Matrix is provided in the "api_example.txt" file under the "api" directory.


Set Files to "Unrestricted" Command-Line Script
	A new command-line script "set_files_unrestricted.php" has been added to the "scripts" directory to allow the URL scheme of File-based assets to be set to "unrestricted" in a batch process.

This script requires the Root User password and takes the Matrix Root Directory and a Root Node asset ID from which to process the assets as parameters.


FLV File asset
	Similar to the MP3 File asset, the FLV File asset provides storage for a media file and automatic metadata extraction by the getID3() third-party tool, as configured from the "External Tools Configuration" screen in System Configuration.

Metadata is stored as FLV File asset attributes and can be manually overridden at any time. Extracting the metadata again from the "Details" screen will overwrite any previous manual changes made to this data.


System Backup Script shell modification
	The Matrix system backup script, "backup.sh" in the "scripts" directory now uses the /bin/sh shell instead of /bin/bash for increased portability.


Remove Permission Types via Future Permission setting and Trigger Action
	The Set Future Permission functionality, which allows permissions to be "Applied" or "Denied", now has the functionality to delete permission associations either from the associated Trigger Action or the asset "Permissions" screen.

In order to remove a permission from the "Permissions" screen, select "Remove" from the "Add / Remove" drop-down list in the "Future Permissions" section, then select the relevant appropriate "Apply" or "Deny" rule and target asset to affect.


E-Commerce: PayPal Payment Gateway
	Payments via PayPal are now supported in the E-Commerce package through the "Buy Now" one-click infrastructure. A simple PayPal-based storefront can be established through the configuration of the following asset types:

	* PayPal Configuration
	This asset stores information regarding encryption of PayPal transactions. The PPCrypto.php library file supplied by PayPal must be installed on the system and referenced from this asset in order to configure the PayPal Payment Gateway.

	* PayPal Business Account
	PayPal Account information for the storefront is stored in this asset, which includes public and private certificates to encrypt transactions between Matrix and PayPal. PayPal Business Accounts may be set in "Sandbox" mode for testing purposes and then to "Live" via a single attribute switch.

	* PayPal Payment Button
	This asset provides a "Buy Now" PayPal Button for a product. Product details such as item name, price, currency, the associated PayPal Configuration and Business Account is configured from this asset. Custom variables can be configured within the Payment Button which are posted back to Matrix from successful transactions.

	* PayPal IPN Receiver
	Successful Instant Payment Notifications are posted back to this asset. The IPN Receiver is configured to post back to an asset of choice, which may be determined by one of the variables posted back from PayPal (ie; carried through the transaction) or a fixed asset. The notified asset generates a "PayPal IPN Received" Trigger Event.

	* "PayPal IPN Received" Trigger Event
	This Trigger Event is used in the "Condition" section of a Trigger to perform operations upon successful payment. This can include granting permissions to the "purchased" asset for a subscription-based system or sending an email to the user.


Matrix SOAP Server
	A SOAP Server has been added to the Web Services package to enable core-level Matrix functions to be executed and queried by clients over the Simple Object Access Protocol.

The SOAP Server comes with a handful of APIs, each which performs a distinct set of Matrix functionality. These APIs are as follows:
	* Asset Service
	* Designs and Lookups Service
	* File Service
	* Link Service
	* Metadata Service
	* Permissions and Roles Service
	* Search Service
	* Workflow Service

Each API is an asset which is selected from the Asset Map and linked under a SOAP Server asset, which in turn is linked under the Web Services Folder.

The availability of APIs and their associated functions is configurable for each SOAP Server instance. For example a SOAP Server instance may be set up to allow retrieval of asset information via the Asset Service, but not creation of new assets. Each API and required function must be explicitly enabled before they are available for use.


Additional Changes and Bug Fixes
-----------------------------------

Web Services
+ SOAP Server error handling - an error handler has been added to log any SOAP Server errors to the Matrix Error Log

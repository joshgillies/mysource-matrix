MYSOURCE MATRIX CHANGELOG

VERSION 3.18.9

Featured Changes
-----------------------------------
E-Commerce Payment Gateway: Credit Card details removed from session
	Credit Card information is no longer stored in the User Session when using the Payment Gateway with ESec. Form data is now passed directly to the SecurePay gateway. A side-effect of this is that the form fields for the Payment Gateway are no longer pre-populated with the user's previous input.


E-Commerce Checkout: Total Cost rounding
	The Ecommerce Checkout asset now rounds the total cost of the cart using a new "Float Precision" attribute.  This attribute is only editable if the receipt is chosen to be customised on the "Display Formatting Options" screen. The default "Float Precision" value is 2. 


Starting tag for XML Data Source and Weather Company Feed assets
	A starting tag can now be specified in XML Data Source and Weather Company Feed assets to control the parsing of shadow assets resulting from the XML source. This is used to delineate tags with the same name appearing in multiple levels in the XML output, to ensure that the intended target is used.

The starting tag is specified from the "Details" screen of both asset types.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed Bug #3393: Previewing an asset after edit gives error about URL
* Fixed Bug #3394: Web connectivity causes PHP time-out when a URL is not supplied
* Fixed Bug #3399: recreate_link_tree.php script fails on Oracle with 'invalid relational operator' error
* Fixed Bug #3403: system_update_lookups.php script fails on an Oracle system
* Fixed Bug #3405: Category field on the Trigger not working correctly 
* Fixed Bug #3427: Cron Issues: Uncaught exception
* Fixed Bug #3438: Keyword condition not evaluated correctly when keyword value is 0/false
* Fixed Bug #3440: Trigger to remove all metadata schemas errors
* Fixed Bug #3446: Rollback mode causes Asset Map errors
+ Microsoft Excel and PowerPoint, RTF, Text, CSS and JavaScript file types are now created as their respective file-specific Matrix assets when imported via the "Bulk File Import" tool.

Bulkmail
* Fixed Bug #3358: Bulkmail - HTML/text option
* Fixed Bug #3431: Bulkmail cannot send emails to XML User Bridge Users
* Fixed Bug #3433: Bulkmail error log contains undefined index messages
* Fixed Bug #3441: Bulkmail Job does not send email to a singly selected user
+ Global Keywords are now replaced in content sent from Bulkmail Job assets.

Calendar
* Fixed Bug #3385: Cannot create more than one Multi-Date Calendar Event under a common parent
* Fixed Bug #3388: PHP notice when previewing the Upcoming Events Page
* Fixed Bug #3429: Single Calendar Events without time get sorted incorrectly

CMS
* Fixed Bug #3397: Incorrect encoding of ampersand in custom forms
* Fixed Bug #3407: Default values for listing engine min/max depth is 0 for Oracle systems 
* Fixed Bug #3418: Asset listing on Oracle systems with min/max depth set to non-null and group by parent breaks

Data
* Fixed Bug #3436: XML User Bridge User Group Details and Linking screens fail
* Fixed Bug #3443: XML User Bridge User Groups and Users are not able to be linked
* Fixed Bug #3444: getAssetInfo() for XML User Bridge is broken for User Groups

Google Maps
* Fixed Bug #3430: Google Map page sends MIME application/geplugin when Google Earth plugin turned off

LDAP
* Fixed Bug #3419: Linking a LDAP user to a User Group causes a PHP notice error

Search
* Fixed Bug #3386: Search page structured root node keyword throws exception if not configured



VERSION 3.18.8

Featured Changes
-----------------------------------

New "Creation User" Asset Keywords available

	New asset keywords %asset_created_by_asset_id% and %asset_created_by_url% have been added to provide the asset ID and URL respectively of the User that created the asset.


"Add Web Path" Trigger Action keyword and option enhancements

	The "Add Web Path" trigger now accepts keywords in the webpath field. Both global keywords and asset keywords for the "firing asset" are accepted. There is also a new check box (disabled by default) to delete all previous webpaths on that asset.


Asset Contents Paint Layout keyword

	A new keyword %asset_contents_paint_xx% is available for use in the Type Formats bodycopy of assets based on Listing Engine such as Asset Listing. The "xx" denotes the name of a User-Defined Paint Layout associated with the asset. The keyword will print the asset contents as rendered with that Paint Layout.


"Remove Asset Remaps" Trigger Action

	A new Trigger Action has been added to manage entries in the Remap Manager. Remapped and/or original URLs which match any of the current asset's URLs can be removed with this action. 


New File Types and file content indexing modifications

	CSS and JS File assets have been added. These asset types inherit from the File asset and their contents are *not* indexed by Search Manager. Content of Text File assets is now available for indexing by Search Manager.


Interface Mode Trigger Condition

	This Trigger Condition evaluates whether the user is in a particular interface mode (ie; frontend, backend, limbo, login, cron). 


"Delete Future Lineage" Trigger Action

	This Trigger Action allows a Future Lineage to be removed between the asset that fired trigger and an asset specified within the action. The Future Lineage is removed by the Cron Manager in a manner similar to "Delete Link" from the asset "Linking" screen. The removal time is specified within the Trigger Action.


"Redirect" Trigger Action

	This Trigger Action will redirect the user to a specified URL. Asset-based keywords may be used to specify this redirect URL.


"Remove Links" Trigger Action

	This Trigger Action removes the association between the firing asset and a specified set of candidate parent links. Links removed can be limited by one or more of the following: asset type, link type, link value.


Safari Compatibility

	Changes have been made to the WYSIWYG editor and the multi-text option list interfaces to provide increased compatibility with Safari.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed Bug #3326: %details-S_details% for file asset doesn't print the titles for the input
* Fixed Bug #3347: Hierarchy not returning results on search page
* Fixed Bug #3349: Wrong link "asset workflow screen" on Details screen in simple edit mode
* Fixed Bug #3350: Move up/down button fails to reorder the list when there's more than three items
* Fixed Bug #3351: In Safe Edit mode, divisions are still deletable
* Fixed Bug #3352: In JS Option List, removing last field throws js exception, if there's value in it
* Fixed Bug #3354: Converting a content type result in Oracle notice 
* Fixed Bug #3355: Files not cleanly removed from file repository
* Fixed Bug #3356: Condition_server_variable doesn't ensure $_SERVER variable is set
* Fixed Bug #3364: Login form design area automatically created in trash
* Fixed Bug #3376: Paint Layout Condition: User Frequency throws php error
* Fixed Bug #3378: Improve the instructional copy for the Set Thumbnail Trigger Action
* Fixed Bug #3383: Id:# field in insert image and insert link not working
+ New Root password can be specified as a parameter to the Reset Root Password command-line script

CMS
* Fixed Bug #3353: New Nested assets functionality - multiple issues
* Fixed Bug #3360: Cloning asset builder with customised create layout fails

Calendar
* Fixed Bug #3363: Event Personalisation on Calendar Page does not show events
* Fixed Bug #3371: Columns don't work for the day view on the calendar
* Fixed Bug #3372: No Results Bodycopy overrides event view on the calendar page
* Fixed Bug #3380: Field name missing on the Restricted-Period Calendar Page

E-Commerce
* Fixed Bug #3379: Correct the approach taken when calculating tax amounts



VERSION 3.18.7

Featured Changes
-----------------------------------

Relative Position Formats in Listing Engine

	Negative Position Formats are now allowed in the "Display Formats" screen of Listing Engine assets such as Asset Listing and Search Page. Numbers relative to the last element can be specified so the Display Format is applied in the same position each time, regardless of the number of elements in the list. For example, -1 represents the last item, -2 the second-last item.


Trigger Categorisation

	Triggers can be categorised in Trigger Folders, which can be used to manually group related triggers. Categories are assigned from a text field on the "Details" screen of the Trigger. If a multiple-folder structure is required, then folder names can be separated by a forward slash (/). Triggers can be moved between categories by reassigning this value.


Trigger Condition: HTTP Request Method

	This Trigger Condition controls whether or not to continue with trigger execution depending on the type of HTTP request which invoked the trigger. The request types available are GET, POST, PUT and DELETE.


Restriction of Metadata Sections by Asset Type

	Metadata Sections can be made available on an asset type-basis. Multiple asset types may be selected per section. Asset type restrictions are configured on the "Details" screen of the Metadata Schema.


Alternative Proxies for Remote Content and XML Data Source assets

	Remote Proxy configuration now applies to Remote Content and XML Data Source assets.


Matching on Selection Fields in Metadata Value Trigger Condition

	It is now possible to define a Metadata Value trigger condition for a Metadata Select field. These fields were previously not available for selection from the Asset Map in this condition. 


Asset Status selection in Broken Links Report

	Asset status selection has been added to the Broken Links Report to filter assets included in this report. The default is to list all Live assets.


Text-only Bulkmails option and preservation of encoding

	An "Email Type" option is now available from the "Details" screen of Bulkmail Job assets that allows you to send text-only bulkmails. The character set defined on the "Settings" screen of the asset being sent will be used when sending the bulkmail rather than the system default. 


E-Commerce Order auditing and categorisation

	An audit trail is now logged against Order assets to track each important step of an order. For example, the date/time and order was sent to the Payment Gateway and whether or not the order was successfully placed. This audit trail is available from the "Details" screen of each order. A SecurePay Transaction ID is also maintained against each order.

Three order state folders are now available under the Checkout asset: "Pending", "Completed" and "Orders to Review". Orders are placed in the "Pending" folder before being sent to the Payment Gateway. These orders are moved to the "Completed" folder after a successful transaction. Failed orders are kept in the "Pending" folder.

Orders which have been processed but fail due to insufficient product quantity - as defined on the Checkout asset - after the transaction has been processed, are moved into the "Orders to Review" folder. 


"Notice Link" and Link Value control

	Notice Links can now be added, modified and deleted from the asset Linking screen. Link values can also be set from this screen. 


Metadata Keywords, Menu and Lineage Design Areas in Design Parse Files

	Metadata keywords, menu and asset lineage design areas can be used in the <MySource_PRINT> tag in design parse files. Standard asset keywords (such as "%asset_type%") are also available in this manner. 


Bulkmail Conditional Sending Filter

	Bulkmail Jobs can be prevented from sending when the body content of the asset being sent matches specified content. For example. a job which uses an Asset Listing as content could be configured to be ignored if the asset list was empty (ie; matches specified text or HTML in the "No Results" bodycopy).


Session Cleanup Script modifications

	The "session_cleanup.sh" script in the "scripts" directory will now remove all session files starting with "sess_". Previously this script removed files based on a specific filename length. This change accommodates systems where PHP 5 has been configured to use an alternate session ID generation hashing scheme.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed Bug #3278: Incorrect inheritance of lookups (designs/paint layouts)
* Fixed Bug #3288: Wrong numeric entity encoding of metadata values on the front end
* Fixed Bug #3301: Trigger_condition asset misses inclusion of its parrent class
* Fixed Bug #3312: add_remove_url.php script broken if site is tagged
* Fixed Bug #3324: Using _recache suffix gives a blank screen
* Fixed Bug #3326: %details-S_details% for file asset doesn't print the titles for the input
+ A new Global Keyword in the format %globals_server_xxx% has been added, to make values from the PHP $_SERVER array available for use
+ Any asset type may now be linked underneath a User asset

Bulkmail
+ Bulkmail Jobs can be sent to a Search Folder to allow sending to Bulkmail and User asset types resulting from a predetermined search query

CMS
* Fixed Bug #3276: Asset Builder crashes when too many &nbsp; characters are submitted and indexed
* Fixed Bug #3280: Parent attributes of linked assets
* Fixed Bug #3316: Global Keywords don't work in Asset Builder Bodycopies
* Fixed Bug #3319: Asset Builder: Captcha keywords don't work in custom form layout

E-Commerce
* Fixed Bug #3314: Transaction ID is lost if payment gateway times out

Google Maps
* Fixed Bug #3310: Error message when using Google Maps
+ An option to enable a Google Earth map equivalent from the "Details" screen of Google Map asset is now available

Search
* Fixed Bug #3287: Backend Search issues a PHP notice



VERSION 3.18.6

Featured Changes
-----------------------------------

URL Parameter support in Remap Manager

	Remap Manager now supports URLs containing parameters for remapping. URLs of the form "http://example.com/page?param=1" will be compared for an exact match. Failing this, Remap Manager will fall back to any matches by URL without parameters (ie; "http://example.com/page") before issuing an HTTP 404 (Not Found) error.


Future Permission Trigger Action

	A new trigger action "Future Permission" and a related Cron Job have been added. This action allows permissions to be granted or denied for users or groups in the same manner as is available on the "Permissions" screen of an asset. Future Permissions may also be set directly from the asset "Permissions" screen.


Markdown Content Type

	A new Markdown content type has been added to the CMS Package. This content type takes a simplified equivalent of HTML as an alternative to Raw HTML and WYSIWYG. This content type interfaces with third-party tools, "markdown" and "markdownify", which need to be configured on the "External Tools Configuration" screen of System Configuration to provide this functionality.


Messaging Service Email Notification change

	Email messages generated by the Messaging Service (eg; workflow notifications) are no longer sent to "User" assets. Only users who can access the backend (ie; "Backend Users" or above) will be sent these messages.


Messaging Service and Bulkmail emails Character Set change

	Email messages generated by Matrix including workflow notifications and Bulkmail content now use the Matrix Default Character Set defined in "System Configuration", instead of the default (usually ISO-8859-1).


New Session Global Keyword

	A new Global Keyword in the format %globals_session_*% is available which can access items in the Matrix Session sandbox.


Time-Based Triggers

	A "Metadata Time" Trigger Event and Condition, and a new Cron Job have been added to support triggering of events based on the date/time stored in a specified Metadata Date Field. A "Metadata Time" Trigger Event is fired which can then be captured up by triggers to perform Trigger Actions with these assets.


Filtering by Thesaurus Terms in Related Asset Listing

	Thesaurus assets can now be liked on the Details screen of Related Asset Listing to further filter the listing by tags. The "Thesaurus Filters" attribute on this screen provides this functionality. Only assets that are tagged by terms defined in these Thesaurus assets will be listed.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed Bug #2812: Custom Form Captcha image has no ALT tag
* Fixed Bug #3228: Stalled HIPO screen
* Fixed Bug #3231: attribute asset_types for design area access history can not be set and used
* Fixed Bug #3232: Script error in recreate_link_tree.php
* Fixed Bug #3234: Unlink from parent not working for the create link trigger action
* Fixed Bug #3240: Unable to create a CSS File Customisation
* Fixed Bug #3243: Global keywords in Asset Listing Page Contents (No Results) or Default Format don't print
* Fixed Bug #3247: Error in html_tidy.inc
* Fixed Bug #3248: Design Customisation: design areas duplicated and pre-customised 
* Fixed Bug #3250: Cascading does not work when deleting permissions
* Fixed Bug #3255: Cache CSS Files - Fatal Error
* Fixed Bug #3257: Error occurs on asset listing when the page content (no result page) is disabled
* Fixed Bug #3260: Errors in several scripts in /[mysource home]/Scripts
* Fixed Bug #3261: Script system_integrity_run_tidy.php complains about $this variable 
* Fixed Bug #3267: Set Permission Trigger Action ignores "Cascade this new schema to newly-created children" option
* Fixed Bug #3268: Not allowed file types being created 
+ MS Word and MS Excel file types now accept Microsoft Office 2007 files with "docx" and "xlsx" extensions

Bulkmail
* Fixed Bug #3225: Bulkmail does not expand user groups when sending
* Fixed Bug #3235: pear::Mail hard coded character encoding

CMS
* Fixed Bug #3236: Custom Form cloning and keywords
* Fixed Bug #3256: Online Quiz frontend printed without design applied to it
* Fixed Bug #3270: Asset Listing show root nodes
* Fixed Bug #3275: Manage Pending Accounts Cron Job dies with a fatal error

E-Commerce
* Fixed Bug #3242: E-commerce Form - Select field "leave empty" not working as expected
* Fixed Bug #3277: E-com form_summary keyword display incorrect information

Search
* Fixed Bug #3253: Paginated search results numbering wrong



VERSION 3.18.5

Featured Changes
-----------------------------------

HTML Tidy binary used instead of libtidy PHP module

        MySource Matrix now uses the command-line version of Tidy instead of the libtidy plugin. The path to the HTML Tidy command must be added to the "External Tools Configuration" screen under "System Configuration" in order to provide this functionality.


Reset Bulkmail Job script

	This new command-line script, "reset_bulkmail_job.php", located in the Bulkmail package, prepares the specified Bulkmail Job so it can be queued for sending. This is achieved by changing the status of the Bulkmail Job from "Live" to "Under Construction". This script can be added to the system crontab to run on a schedule and takes the Matrix System root directory and the asset ID of a Bulkmail Job as parameters.


Asset Listing modifications to display Root Nodes

	Asset Listings can now be configured to include root nodes in listings. When the minimum asset depth is set to zero, the Root Nodes will be included in the results. When both the maximum and minimum asset depths are set to zero, only the Root Nodes will be shown.


File Upload Questions add Notice Links to related Form Submissions

	A Notice Link is now created between "File Upload" questions in Custom Form and the related Form Submission asset. An info icon and link to the uploaded file is provided when viewing individual submissions from the "Edit" link.


Metadata Fields as required attributes in Asset Builder

	Metadata Fields can now be assigned as required attributes in Asset Builder to prevent asset creation if they are not present.


Asset Sort Order System Integrity script

	A new command-line script is available in the "scripts" directory called "system_integrity_fix_sort_orders.php", to verify and correct the asset sort order in the database. This script takes the Matrix System Root directory and an asset ID from which to start the repair. An incorrect sort order in can cause Asset Map errors, especially in paginated lists. This script is quite intensive and can potentially run for an extended period, so it is recommended that these factors are considered before running the script on a live system.


Google Maps Package (available under the SSV licence)

	A new MySource Matrix package is available which provides functionality for providing customised maps through the Google Maps service. Two new asset types - "Google Map" (based on Asset Listing) and "Google Location" - can be configured manually or set up to retrieve location information from other assets and plot the corresponding locations and secondary information.


Search Page: Default Sort Order changed

	In order to provide the most relevant data at the top of search results in the default configuration, Search Page now has a default sort order of "Descending" instead of "Ascending". This value is controlled from the "Asset Sorting" screen of this asset.


Search Page: New keywords and pagination control

	Pagination keywords from Listing Engine asset types, such as Asset Listing, are now available for use in Search Page. A further two new keywords, "%current_result_page_start%" and "%current_result_page_end%", are also available to show the result number of the assets listed at the start and end of the current page.


Suffix "_recache" now re-caches nested content

	The "_recache" suffix now operates based on the URL instead of on an asset basis in order to provide recaching of nested content.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed Bug #3178: Simple edit maintaining active locks
* Fixed Bug #3187: Triggers do not match "Tree Location" when used with linked child assets
* Fixed Bug #3188: Unicode characters get corrupted when tidy is on
* Fixed Bug #3190: Rollback doesn't display nested content assets
* Fixed Bug #3203: IE6 displays non-secure items msg when logging into backend on https
* Fixed Bug #3204: Word Document HTML Clipboard Tags get pasted through on Firefox 3
* Fixed Bug #3208: Date attributes drop-down is empty in Set Future Status trigger action
* Fixed Bug #3210: Layout and text issues
* Fixed Bug #3216: Cascade not working on the Metadata Schemas screen
* Fixed Bug #3217: Inconsistencies in Paint Layout bodycopy vs. standard bodycopy line endings
* Fixed Bug #3222: Trigger Create Link can lead to orphaned asset

Calendar
* Fixed Bug #3197: Recurring Calendar Event resets "stop date" when attribute is excluded from Simple Edit Layout

CMS
* Fixed Bug #3145: Custom form: warning on create   
* Fixed Bug #3207: Downloading submission log for Custom Form over HTTPS in IE7

E-Commerce
* Fixed Bug #3180: E-commerce Form not logging correctly

IPB
* Fixed Bug #3162: Unknown IPB Users cause Asset Map errors

News
* Fixed Bug #3120: RSS asset produces fatal error with feeds containing the tag 'type' in its items

Search
* Fixed Bug #3193: Search Folder not working with multiple terms
* Fixed Bug #3194: Thumbnail fields no showing on Search Folder



VERSION 3.18.4

Featured Changes
-----------------------------------

Move assets into dated folders script

    A new command-line script "move_assets_to_dated_folders.php" is available in the "scripts" folder which can be used to move assets under a specified parent and asset type under a dated folder structure. Folders are created for each applicable year, month and day. Assets are moved to these folders depending on their 'created' or 'published' dates.


Custom Keywords in Metadata Fields are now indexed by Search Manager

    Asset-based keywords such as %event_start_date% for Single Calendar Events are now evaluated and indexed by Search Manager when used as Metadata Field values. Previously these keywords were not evaluated and were indexed as the keyword without reserved characters (eg; %event_start_date% was indexed as "eventstartdate" instead of the evaluated date content).


Global Keywords replaced when used as a search query

    Global Keywords can now be specified as search terms in a Search Page query. For example, a query containing %globals_asset_name% from a Search Page will be modified when searching to replace the keyword with the name of the Search Page.


Drill-down Display Type added to Metadata Heirarchy fields

    The editing interface for Metadata Hierarachy fields has been modified to provide a "Drill-Down" Display Type. Values can be added from the hierarchy by clicking the "Add" button next to each level.


Paint Layout configuration for Nested Content Design Area

    Three new Paint Layout options are now available in Nested Content Design Areas. These design areas can now use either the default Paint Layout, no Paint Layout, or an arbitrary Paint Layout.


Customisable Receipt Format for E-Commerce Checkout and Default Delivery Method assets

    Customisable formats are now available to configure E-Commerce receipts. This functionality works similar to Asset Listing in that there are "Receipt Format" and "Receipt Contents" bodycopies. Custom keywords are available to show attributes such as price, tax and other fees. The %customised_receipt% keyword is available for use in the email contents of the default delivery method, as well as certain bodycopies of the checkout asset.


Sending email to Shadow Assets in Send Email Trigger Action

    New functionality has been added to Send Email Trigger to allow email messages to be sent to shadow assets (ie; LDAP Users). LDAP Users can be added individually in the "General Options" section, or included when associated with User Groups or Roles.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed Bug #3123: Changed Thesaurus Term used in Metadata not applied correctly
* Fixed Bug #3127: Security Restrictions broken
* Fixed Bug #3133: Unable to change Metadata date min/max values
* Fixed Bug #3136: Regular expressions don't match if alternation is used
* Fixed Bug #3143: Error thrown on call to protected method in User IP Condition
* Fixed Bug #3150: PHP Notice in regular expresion complex validation rule backend interface
* Fixed Bug #3155: Oracle error with getValueFromURL()
* Fixed Bug #3158: PHP Notice in metadata schema date field with min date later than max date
* Fixed Bug #3159: URL suffix "_login" shows secondary login box on sites set to "Require Secure Login"
* Fixed Bug #3167: Metadata field hierarchy drill-down view in asset builder is disabled
* Fixed Bug #3168: Error in Remap Manager
* Fixed Bug #3169: Wrong variables' names in Trigger_Action_Set_Permission class
* Fixed Bug #3171: Oracle error with paint layout change in lookup setting screen

Calendar
* Fixed Bug #3154: Calendar Recurring Event, and Recurring Event Modification
* Fixed Bug #3157: Single calendar simple edit duplicate attributes

CMS
* Fixed Bug #3113: Asset Listing generates DB error when listing "Up the Tree" when viewed by Public User
* Fixed Bug #3141: Email validation does not work with more than one account manager create location
* Fixed Bug #3161: Links report export generates incomplete CSV
* Fixed Bug #3163: PHP Notice in removing pending account in account manager

Data
* Fixed Bug #3172: RSS data source not processing some RSS 2.0 format feeds

E-Commerce
* Fixed Bug #3148: Ecommerce checkout region-specific conditional delivery fee options are not adhered to

LDAP
* Fixed Bug #3139: LDAP Users with a comma in the name, causes database error

News
* Fixed Bug #3126: RSS Feed asset doesn't respect Sort settings when multiple Asset Types are in listing engine

Search
* Fixed Bug #3156: Can not move search page's children assets



VERSION 3.18.3

Featured Changes
-----------------------------------

Delete Bulkmail Users Tool

    This tool will delete all Bulkmail Users from the system that match email addresses present in a text file, which is uploaded as part of the tool's interface.


Unwanted Asset Types Menu Design Area setting

    This new Menu Design Area setting ("unwanted_asset_types") lets you set a number of asset type(s) that are excluded from a menu. The types chosen will also exclude all descendant asset types.


Paint Layout changes

    The way Paint Layouts work in general has been overhauled quite radically. The "Lookup Values" screen has been renamed "Lookup Settings". The changes to this screen in summary:

    - Paint Layouts can now be applied on a per-asset basis, rather than just per URL. Paint Layouts set this way will apply across all URLs of the asset. Per-URL Paint Layout settings are still available.
    - Override Paint Layouts can also be applied at either a per-asset or per-URL level, working similar to designs.

    When evaluating which Paint Layout asset to display, the following rules apply:

    - URL-based paint layouts have priority over asset-based ones. Where no URL-based paint layouts exist for the current URL, the asset-based one will be used instead.
    - All Override layouts take priority over all normal (inherited) layouts. For instance, if you have an Override Paint Layout at an asset level but only an inherited Paint Layout at a URL level, then the Override asset-level Paint Layout takes priority.


Set Paint Layout Trigger Action

    This new trigger action allows you to set an asset-level Paint Layout (both standard and Override) on an asset that fires a trigger. Dynamic parameters can be used to select an alternative asset ID for either one.


Set Paint Layouts on built assets

    Asset-based Paint Layouts can now be set on assets created through an Asset Builder.


Pass extra GET variables to Nest Content

    This new functionality allows you to pass extra GET variables to an asset being included via Nest Content. The values can include global keywords and keywords of the asset you are nesting (using %nested_asset_*% instead of %asset_*%). These extra keywords will overwrite GET variables passed through a query string, but will only have the lifetime of that nesting.


HTTP GET variables available as a Global Keyword

    HTTP GET variables are now available as global keywords using the %globals_get_*% format. Only scalar variables are able to be used as global keywords; arrays are not supported.


Global Keywords in Remote Content URLs

    The Remote Content asset now accepts global keywords in the URL. Caching of output has changed slightly to better handle the possibility for dynamic URLs.


Set "Not Found" Page for archived assets

    This is a new "Special Page" option added to Site assets. It is triggered when a user accesses an asset with "Archived" status, without the appropriate read permissions. (Due to it being archived, users actually need write permissions to get read permission too.) The page behaves exactly like the "Not Found" special page option, in that it will return a HTTP 404 status code.


Schedule Bulkmail Job script

    This new command-line script, located in the root of the Bulkmail package, lets you queue up a Bulkmail Job to run immediately. This can be used by a Cron system outside of Matrix to schedule a time to send a Bulkmail Job. Apart from the system root, the script accepts one parameter: the asset ID of the Bulkmail Job to queue. It will only run if it is not already running (ie. status is set to "Under Construction").


Remove Metadata Schema Trigger Action

    This new trigger action will remove either a single metadata schema (if it exists) or all metadata schemas from the asset that fired the trigger.


Browser Cache Expiry option in Cache Manager

    This option allows you to set a different period for requesting the browser cache the output of a Matrix asset, to the period that Matrix itself caches things using the Cache Manager. Specified in seconds. If omitted or zero (which is the default), these values are the same.


Prevent Cascade of Schemas / Permissions

    It is now possible to designate certain permissions, workflow schemas and metadata schemas with the ability to not cascade to lower assets, regardless of the normal asset-level "Cascade" setting. When this option is selected, new children of the asset (whether created or linked/moved) will not have those settings cascaded to them. (Workflow schemas and permissions will still cascade to their dependent children, to be consistent with current practices of adding these with cascading to existing assets turned off.)


Workflow Approval / Rejection Trigger Events

    Two new Trigger Events are now available for Workflow Approval and Workflow Rejection. These events are fired when a workflow is resolved on an asset in the respective way.


Additional Changes and Bug Fixes
-----------------------------------

Core
* Fixed bug #3053: WYSIWYG does not display mutimedia files when editing
* Fixed bug #3054: Asset filesize (when file has not been uploaded)
* Fixed bug #3057: system_parse_design.php fails with Call to protected method fatal error
* Fixed bug #3059: SQ_CONF_CONFIRM_SAVE_CHANGES reset after upgrade
* Fixed bug #3061: Issues when cloning Design assets
* Fixed bug #3068: Update lookups doesn't log the lookup change
* Fixed bug #3071: Purge Trash warning javascript error
* Fixed bug #3077: Viewing Web Path screen fails on Oracle with 1000+ URLs
* Fixed bug #3096: Printing in IE - Structred Asset Report Screen cut off
* Fixed bug #3102: Setting override design on a site asset fails
* Fixed bug #3107: Old override values applied to assets remain in the lookup values table after URL has changed
* Fixed bug #3108: Asset Map not loading after upgrade to 3.18.1 / 3.18.2

CMS
* Fixed bug #3049: Asset Listing: Group format %group_name% keyword doesn't convert & to &amp;
* Fixed bug #3078: Custom form section_title_xxx keywords do not work in Thank You bodycopy
* Fixed bug #3087: Cloning Custom Form with bodycopy table used result in fatal error
* Fixed bug #3099: Asset Builder required attributes
* Fixed bug #3113: Asset Listing generates DB error when listing "Up the Tree" when viewed by Public User

Calendar
* Fixed bug #3044: Calendar Page: Year view, events with no time don't get sorted
* Fixed bug #3098: Invalid XHTML for calendar output (month view, table format)

LDAP
* Fixed bug #3072: errors linking LDAP users with ampersand in Group name

Search
* Fixed bug #3065: Search log report assign by reference error



VERSION 3.18.2

Featured Changes
-----------------------------------

Hierarchy Metadata Field

    This new metadata field is similar to a Select Metadata Field, but creates a hierarchy based on the keys of the options provided (based on a character-by-character basis, eg. "1A" would be a child of "1"). When searching on this type of field, it will also search for the selected option's parents and children.


Stored Searches for Search Page

    Allows you to map the input of a search field(s) on a Search Page asset to a parameter map source(s). When the asset is loaded with this source filled, the Search Page can be set to bypass the initial search form and show the results page straight away.


Support for Multiple Proxies

    This new feature will allow additional proxy servers for MySource Matrix to use when making requests for external URLs for its own purposes (such as for Remote Content, Links Report, etc), based on matching a URL pattern. If no alternative proxies are matched, the primary proxy (previously the single proxy that could be configured) will be used.


Export Files Tool

    This new tool allows you to export all File assets (and other assets inheriting from File) underneath a certain root node to a compressed tarball (.tar.gz) file. Folder structure can be maintained or removed at user's option.


Date/Time Design Area: Created/Published Date

    The Date/Time Design Area now allows you to print the created and published dates for the asset, in addition to the current date and last updated date.


Raw Form Response Keyword

    New raw keywords return the raw value stored by the form for a response. For some question types such as Text, these will be the same as the normal keyword, but for others it will be different (eg. for Select, this would be the key of the selected option rather than the presentation value). These keywords are named the same as the normal keywords, but with "_raw" added to the end.


Form Submission Actions Infrastructure

    This new infrastructure allows you to create custom actions that interact with a Custom Form, that are run whenever a form is submitted.


Send Email Form Submission Action Asset

    This Form Submission Action allows you to send emails additional to the original three on the Email Options screen.


Database Query Form Submission Action Asset

    This Form Submission Action allows you to run a query on an external database based on the values of a submitted form.


SOAP Server Asset

    This feature provides the framework for external systems to communicate with MySource Matrix. A set of actions for interacting with the system is in development.


Separate Database Connection for Searches

    Searches can now be optionally redirected to another database connection using the new "dbsearch" DSN. This may prove useful where availability is critical and the database is replicated. If omitted, it defaults to the "db" connection.


Additional Changes and Bug Fixes
-----------------------------------

Core

* Fixed bug #2994: Bug in Asset class' morph method
* Fixed bug #3000: Site preview error
* Fixed bug #3003: Design Customisation Creation Failure
* Fixed bug #3009: Cannot remap upon trashing
* Fixed bug #3010: Remaps missing from web path screen
* Fixed bug #3011: Paint Layout: User Defined Layout Error
* Fixed bug #3014: Morph File (Image, PDF, ect.) assets error
* Fixed bug #3021: Rollback Management script does not set "effective from date" when purging other entries
* Fixed bug #3026: Image variety inserted into bodycopy with WYSIWYG fails in safe edit
* Fixed bug #3029: Code that generates the WYSIWYG CSS selector breaks if double quotes exist in CSS rules
* Fixed bug #3033: Fatal error attaching image variant
* Fixed bug #3037: Paint Layout: Admin condition throws PHP Error
* Fixed bug #3039: View all workflow logs' link causes PHP Notice error
* Fixed bug #3041: Thesaurus terms that include a comma do not display in metadata fields in the admin interface
* Fixed bug #3045: Keyword Regexp Condition can't handle OR ("|") condition
+ System Time Zone now customisable from System Configuration screen
+ Unsaved Changes warning can now be toggled from System Configuration screen

CMS

* Fixed bug #3004: Online quiz throws fatal error if it is tagged by a thesaurus term (Online Quiz)
* Fixed bug #3008: Moving asset in Asset Listing page (Listing Engine)
* Fixed bug #3022: Source string missing for 'Standard Asset Field' in Listing Engine-based assets (Listing Engine)
* Fixed bug #3032: Online Quiz asset is cached by default (Online Quiz)

Calendar

* Fixed bug #2995: Global keywords not being replaced in Calendar Asset (Calendar Page, Rolling Calendar Page, Upcoming Events List)

Data

* Fixed bug #2992: RegEx inclusions error in db data source (DB Data Source)

News

* Fixed bug #3031: RSS Feed asset not working after upgrade (RSS Feed Page)

Search

* Fixed bug #3002: Search Field Name that contains a full stop will not work (Search Page)
* Fixed bug #3012: Search Page not being able to set attribute value as search fields (Search Page)
* Fixed bug #3042: Oracle Search: reserved words not escaped when in "begins with" mode (Oracle Search Plugin for Search Manager)
* Fixed bug #3013: Metadata thesaurus field is wrongly indexed by Search manager (Search Manager)

E-Commerce

+ Ability to specify delivery fees by country per weight metric
+ Ability to specify an additional international delivery fee for all countries except those selected
+ Ability to specity additional charges, or delivery fee exemption, based on price of cart and country



VERSION 3.18.1

Featured Changes
-----------------------------------

Metadata Value Trigger Condition

    This trigger condition makes its appearance for the first time in the 3.18.x branch. This condition allows triggers to be excuted or not based on the value of a metadata field applied to the asset the trigger is firing upon. Also, this condition is now allowed to be specified multiple times within the same trigger.


Backend Unsaved Changes Warning

    A warning message will now appear if you try to move away from a page on the Matrix backend while you are editing an asset. This allows users who try to accidentally navigate away from the backend to negate their action and not lose unsaved changes.


Global Keywoards Replaced in Simple Edit

    Global keywords - those keywords beginning with "globals_*" that refer to current user, current asset, arbitrary asset, and so on - are now replaced in Simple Edit interfaces.


E-Commerce Product Tax Handling

    Products now can be configured to include tax upon checkout, by enabling the "Calculate Tax During Checkout" attribute for each applicable product. Product prices can be specified as tax-exclusive or tax-inclusive, by using the "Product Price Already Includes Tax" setting.


E-Commerce Checkout Region-Specific Options Screen

    This new screen allows you to set extra charges based upon the country of delivery (based upon a Country-type form question), for products that have the "Calculate Tax During Checkout" setting set.


Additional Changes and Bug Fixes
-----------------------------------

Core

* Fixed bug #2950: Search page with option list attribute set as search field displays PHP warning
* Fixed bug #2951: Sending html through POST gets strange results
* Fixed bug #2952: Set Metadata value trigger problem when metadata field is deleted
* Fixed bug #2954: Commit button missing on the Metadata static screen, even when some fields are editable
* Fixed bug #2958: Start date of Single Calendar Events shows incorrect duration in backend
* Fixed bug #2964: Stalled HIPO causes "MySource Notice" in top frame of administration interface
* Fixed bug #2970: Warning when editing metadata date field
* Fixed bug #2971: PHP Notice Message in Trigger Action Calculate Average Rating
* Fixed bug #2973: Unbound variable error when applying workflow
* Fixed bug #2975: Error in updateLink if the link is to a shadow asset
* Fixed bug #2977: Array to String conversion error printing lineages where lineage contains a shadow asset
* Fixed bug #2980: Underscore "_" and Dash "-" in webpaths treated as same character
* Fixed bug #2987: URL for Matrix cache incorrect for multiselect
* Fixed bug #2989: deletePermission() method missing for Thesaurus
* Fixed bug #2991: Linking screen keyword %linking-% displays read-only in Simple Edit when used alone

CMS

* Fixed bug #2949: Image remains on page after being cleared from image div (Image Content Type)
* Fixed bug #2974: Custom Form submission logs won't load (Custom Form)
* Fixed bug #2982: Asset Builder: Additional Create Locations POST problem (Asset Builder Page)
* Fixed bug #2986: Form question cause infinite recursion (Form Question)
* Fixed bug #2990: Asset replacement doesn't work with a single value (Asset Listing Page)

Calendar

* Fixed bug #2962: Rolling Calendar page does not display event types that inherit from Single Calendar Event (Rolling Calendar Page)

Search

* Fixed bug #2981: Backend Quick Search fails for non-System Admin User (Search Manager)

Squid

* Fixed bug #2969: Clear Squid Cache trigger action, url passed to squidclient (Clear Squid Cache HIPO Job)

E-Commerce

* "Display Extra Options" screen renamed to "Taxation and Flat Fees" (E-Commerce Checkout)
* "Includes Tax" setting on Product's Details screen clarified to "Product Price Already Includes Tax" (Product)
* Receipt formatting now allows pre-tax and post-tax price to be specified for each product (E-Commerce Cart)


VERSION 3.18.0

Featured Changes
-----------------------------------

Set Thumbnail Trigger Action

    This new trigger action takes an asset ID of an Image asset from a parameter map variable (GET data, POST data, and Matrix "session" data), which is then linked as the thumbnail of the current asset.


Negative On-Hand Quantity Support in E-Commerce System

    If a customer has paid for their cart, but between that time and delivery there are insufficient quantities of product(s) to fulfil the order, then the order will still go through, causing product quantity fields to turn negative. Fields are available in the Default Delivery Method to alert the form's owner to any back-ordering required.


Default Delivery Method Changes

    The Default Delivery Method now allows you to process your cart using the eSec Payment Gateway asset. Emails will only be sent upon successful payment processing if this option is selected. There is also a new option to stop emails being sent.


Additional Changes and Bug Fixes
-----------------------------------

Core

* Fixed bug #2897: File attachment problem
* Fixed bug #2917: generateGetParentsQuery doesn't batch $in_sql for IN clause
* Fixed bug #2939: Asset map does not display $ sign when it is followed by a number
* Fixed bug #2942: linking screen - PHP5 deprecated message

CMS

* Fixed bug #2914: Asset Builder: Dynamic Create Locations Folder Problem (Asset Builder Page)
* Fixed bug #2918: Listing Engine "Current Asset ID" Dynamic Parameter Caching Problem (Listing Engine)
* Fixed bug #2921: When validated an external link, a malformed url causes an error (Links Report)
* Fixed bug #2932: incorrectly tunnelling different protocols (Remote Content Page)

Calendar

* Fixed bug #2902: Event Label Format keywords don't work in List views on Calendar details screen (Calendar Page)
* Fixed bug #2910: Link to 'Event view' in event Limbo edit mode doesn't work (Calendar Page)
* Fixed bug #2930: Recurring events not recurring (Recurring Calendar Event)

LDAP

* Fixed bug #2945: LDAP Bridge returns getChildren() array in the wrong format (LDAP Bridge)



VERSION 3.18.0 RC2

Featured Changes
-----------------------------------

Resume HIPO Jobs In New Window

    The HIPO Herder screen now allows users the option to resume stalled HIPO Jobs in a new window, leaving the main window free to do other tasks. The original option to open in the main window still remains.


Filter By URL In Remap Manager

    This feature allows URLs on the Remap Manager asset's "Remapped URLs" list to be filtered by their original and/or remapped URL.


Clear Matrix Cache for Multiple Root Nodes

    The Clear Matrix Cache tool now allows multiple non-dependant assets to be cleared in a single run.


Direct Entry of Asset ID in Asset Finder

    The Asset Finder widget has been changed slightly. The widget now supports the manual entering of an asset ID in the smaller box to the right of the "Id: #" label.


Character Limit for Metadata Text Field

    Metadata Text Field assets now contain an option to constrain the number of characters that said metadata field can contain.


Size of Metadata Text Field

    Metadata Text Field assets now contain an option to customise the size of the field as displayed by such methods as Simple Edit keywords.


Option to Control Remapping of Web Paths

    This feature allows users to override the previous behaviour of creating entries in the Remap Manager whenever a web path is changed. The default setting is set in the Remap Manager asset, and can be overridden on a change-by-change basis on an asset's Web Paths screen.


New Re-Cache Suffix

    This new suffix (default "_recache") will display the most recent version of an asset (like "_nocache"), but will also clear and re-populate the Matrix cache for that asset. This suffix will only work if the user has write access to that asset.


User Name on Asset History Screen

    The History screen of an asset now shows the name of the user that committed each version.


Exclude Assets From Asset Listing Page

    The Asset Listing Page can now be set to exclude one or more assets from being listed in that asset


Approve/Reject Links In Workflow Emails

    The emails sent to users involved in the running workflow of an asset now have direct links to approve or reject the workflow.


Metadata Value Cascading

    This feature allows default and/or custom values to be cascaded to child assets on a field-by-field, asset-by-asset basis.


CAPTCHA Field in Asset Builder Page

    This feature aads the option to insert a CAPTCHA test to an Asset Builder Page. When the "Require CAPTCHA" option is enabled, a number of CAPTCHA-related keywords will be made available to the Logged In bodycopy. The look and size of the CAPTCHA can also be modified.


Image Content Type Can Use DIVs

    The Image Content Type asset now has the option to wrap the image in a DIV tag, instead of the default behaviour of a TABLE tag. The default is determined by a user preference.


New Sorting Options for Asset Sorting Tool

    The Asset Sorting Tool can now sort assets by Asset Attribute as well as by standard asset fields.


Use HTML Tidy as Accessibility Checker

    This feature uses the HTML Tidy extension of PHP 5 to conduct automated components of WCAG accessibility checks. Failed accessibility checks are available as a new icon mouse-over, next to the Bodycopy's current HTML Tidy status indicator.


Workflow Approval/Rejection Trigger Events

    These new Trigger Events are fired when a running workflow is completed and resolved in either approval or rejection.


Option to Disable Roles

    These System Configuration options will allow you to disable the Roles system, or just the Global Roles component. This will increase performance for systems that do not need them.


Metadata Value Trigger Condition

    This new Trigger Condition returns the result of a match between a specified value, and the value of an asset's metadata field.


Additional Changes and Bug Fixes
-----------------------------------

Core

+ Experimental PHP 5 support for Oracle databases (we believe this currently requires PHP >= 5.2.6RC1)
* Fixed bug #2801: Insert Div window positioning in IE
* Fixed bug #2825: Mandatory metadata link does not work on newly created assets
* Fixed bug #2837: Fatal Error Step03 get_class_lower()
* Fixed bug #2839: Workflow notifies all editors when approver cannot approve asset due to missing mandatory metadata
* Fixed bug #2842: Can't send multi-line internal message
* Fixed bug #2849: Can not create specific file asset (PDF,DOC, JPG) using File Asset if File Extension Restriction in Global Preferences or User Group Preferences is used.
* Fixed bug #2856: Single quotation mark in metadata field name cause Matrix to throw fatal error
* Fixed bug #2857: Paint Layout based on IP authentication
* Fixed bug #2860: PHP date information does not work as expected in conditional keywords
* Fixed bug #2878: WYSIWYG CSS randomly not detected when using login designs
* Fixed bug #2880: Can't use Table Properties Row selector in IE
* Fixed bug #2884: Editing metadata from the front end on dropdown menu not saving changes
* Fixed bug #2887: Image Variety within Workflow
* Fixed bug #2888: MySource ERROR on webpath insertion
* Fixed bug #2905: Workflow internal message link invalid

CMS

* Fixed bug #2777: STRONG tags inserted into Text email (Custom Form Page)
* Fixed bug #2866: Custom form - response keywords doesn't update in a cloned form (Custom Form Page)
* Fixed bug #2869: Site Map does not list assets underneath Folder assets, if 'Inherit' is specified (Site Map)
* Fixed bug #2874: Account Manager fails to display with login design applied (Account Manager Page)
* Fixed bug #2883: Asset Builder not showing all selectable locations (Asset Builder Page)
* Fixed bug #2907: Online Quiz Question Group keyword replacements are not replaced for the Root User (Online Quiz)

Calendar

* Fixed bug #2862: If Calendar Page is nested in Rolling Calendar, Date Incorrect (Rolling Calendar Page)
* Fixed bug #2902: Event Label Format keywords dont work in List views on Calendar details screen (Calendar Page)

E-Commerce

* Fixed bug #2815: E-Com Product Asset Simple Edit Issue (Product)
* Fixed bug #2865: Cannot create an Ecom Form under a folder with a specific metadata schema (Ecommerce Form)



VERSION 3.18.0 RC1

Featured Changes
-----------------------------------

Rewrite To Run On PHP 5

    The MySource Matrix codebase has been revised significantly so that it will run on PHP 5. This was partly necessitated by PHP's recent end-of-life announcement for PHP 4.x. The minimum PHP version required for MySource Matrix 3.18.x is PHP 5.1.6 - this is the version supplied with Red Hat Enterprise Linux (RHEL) 5.


CSV Data Source Asset

    This new asset type, located in the Data package, allows you to store a comma-separated value (CSV) text file. Each row within the CSV file is turned into a Data Record shadow asset.


XML Data Source Asset

    This new asset type, located in the Data package, allows you to capture tags of a certain name from an XML source (not necessarily an RSS feed), and translate them into Data Record shadow assets.


Weather Company Feed Asset

    This new asset type, located in the Data package, is a specialised form of XML Data Source asset, allowing subscribers to The Weather Company's RSS feed services to display data from those feeds as shadow assets in their MySource Matrix system, so they can be listed by Matrix's tools.


Rich Text Format File Asset

    This new asset type, part of Core asset package, is a specialised form of File asset that handles Rich Text Format (.rtf) documents. It has no additional function above what the File asset allows, however it allows RTF files to be handled separately in situations such as asset type customisation.


Optional Purge Root Added to Purge Trash Script

    The purge_trash.php script now accepts an extra parameter - the ID of an asset currently in the trash. If provided, only this asset and their children will be purged, instead of the entire trash. If this extra argument is omitted, the entire trash will be purged as usual.


"Hide Frames By Default" User Preference

    This new user preference will, when turned on, hide the frames (ie. the top bar and asset map handle) in Simple Edit mode by default, leaving only your content visible.


Asset Status Condition Asset

    This new System Condition tests an asset's current status against one or more selected statuses, returning TRUE or FALSE as a result.


Option to Offer HTTP Authentication

    If you enable HTTP authentication on the System Configuration screen (as well as Process PHP Credentials), and also append the query string "USE_HTTP_LOGIN=1" to the login URL, MySource Matrix will now present a browser-level HTTP authentication dialogue box instead of Matrix's usual login prompt.


Import Script Creates File Types Based On Extension

    The import_files.php script will now create assets of more common file types (MS Excel, MS PowerPoint, RTF File, Text File) instead of standard File assets, based on file extension. This extends existing functionality which handled MS Word, PDF and Image files.


New Folder Structure Import Script

    This new sscript allows you to import a flat structure of existing directories into Folder assets under a specified root node. Folders will be named the same as the directories on the filesystem. Directories can then be optionally be renamed to their new asset IDs, allowing the use of the import_files.php script immediately after.


New CSV-Based Import Script

    This new script converts information from three CSV files into assets of a single type. One file provides attribute and metadata values, and the other two files provide a mapping between field names located in the CSV file, and attribute and metadata values.


Multiple Page Page Renaming

    Normally, Multiple Page Page assets are named and renamed based on their position under the parent Multiple Page asset. Now, the web path of these assets can be changed from their default. If these new web-paths are non-numeric, they will not be renamed again when the pages are next re-ordered.



Additional Changes and Bug Fixes
-----------------------------------

Core

+ Performance improvements to the storage and execution of lookup values (ie: calculation of designs and paint layouts)
+ Improvements to HIPO locking algorithm: some HIPOs will lock one asset at a time, rather than locking the entire work set
* WYSIWYG elements now use internal PHP 5 HTML Tidy extension, instead of using an external tool version
* Custom DSNs changed from PEAR DB standard to PDO standard (Set Cache Expiry Trigger Action)

Data

* Custom DSNs changed from PEAR DB standard to PDO standard (DB Data Source)
